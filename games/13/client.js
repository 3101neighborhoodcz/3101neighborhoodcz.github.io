var Uo="1.0.10";var Ft=(e,t,o)=>(e.has(t)||e.set(t,o(t)),e.get(t)),Dt=(e,t,o)=>e<<16|t<<8|o,Yt=e=>Dt(e,e,e),Q=e=>{if(e.length&&e.charAt(0)==="#"){if(e.length===4)return Dt(parseInt(e.charAt(1),16)*17,parseInt(e.charAt(2),16)*17,parseInt(e.charAt(3),16)*17);if(e.length===7)return Dt(parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16))}return 0},xr=(e,t)=>Dt(t*(e>>>16&255),t*(e>>>8&255),t*(e&255));var Et=0,br=e=>Et=e,M={npc:{initWeaponLen:4,period:10,max:8},items:{lifetime:60},barrels:{initCount:32,hp:[3,7],dropWeapon:{chance:70,min:4}},trees:{initCount:64},camera:{size:256,listenerRadius:256,baseScale:1.1},player:{hp:10,sp:0,mags:1,jumpVel:80,runVel:120,walkVel:60},world:{gravity:5,gravityWeak:3},minimap:{size:48,markerScale:1,colors:{me:Q("#fff"),player:Q("#f00"),npc:Q("#d06"),tree:Q("#888"),barrel:Q("#07f"),item:Q("#0f0"),background:Q("#010"),backgroundAlpha:.6}},bodyColor:[Q("#FF99DD"),Q("#FFCC99"),Q("#CCFF99"),Q("#222222"),Q("#8855FF"),Q("#CCCCCC")],voice:{killAB:["{0} CRUSHED {1}","{0} destroyed {1}","{0} killed {1}","{0} took {1} life"],killNPC:["warm-up for {0}","{0} killed someone","death by {0}","{0} sows DEATH"]}};var _r="l3";var Nn=60,g={name:"",sound:1,music:1,speech:1,blood:1,particles:1,highDPI:1,frameRateCap:Nn,dev:0,dev_fps:1,dev_collision:0,dev_console:1,dev_info:0};for(let e of Object.keys(g)){let t=localStorage.getItem(_r+e);if(t!=null)switch(typeof g[e]){case"number":g[e]=parseFloat(t);break;case"string":g[e]=t;break}}function ne(e,t){return g[e]=t,localStorage.setItem(_r+e,t),t}function ko(e){return g.dev&&g[e]}var _e=new AudioContext,hr=(e,t,o,n)=>{if(!g.sound)return;let r=.5;n=_e.createGain(),n.gain.value=t*r,n.connect(_e.destination),t=_e.createStereoPanner(),t.pan.value=o,t.connect(n),o=_e.createBufferSource(),o.buffer=e,o.connect(t),o.start()},uo=e=>{if(!g.speech||!("SpeechSynthesisUtterance"in window))return;let t=new SpeechSynthesisUtterance(e);t.volume=.5,speechSynthesis.speak(t)};var{max:at,min:se,abs:fo,sin:P,cos:X,atan2:We,hypot:he,PI:O,sqrt:Ae,tan:gr,imul:Sr,round:Dr,exp:Zi,log:Ar}=Math,z=2*O,Fr=O/180,Rt=(e,t,o)=>(1-o)*e+o*t,Er=(e,t,o)=>Zi(Rt(Ar(e),Ar(t),o)),Lo=e=>e&&--e,ge=(e,t,o)=>se(o,at(e,t)),Rr=e=>e>0?1:-1,lt=(e,t,o)=>e<t?se(e+o,t):e>t?at(e-o,t):e;var Tr=`
attribute vec3 a_position;
attribute vec2 a_texCoord;
attribute vec4 a_colorMul;
attribute vec4 a_colorAdd;

uniform mat4 u_mvp;

varying vec2 v_texCoord;
varying vec4 v_colorMul;
varying vec3 v_colorAdd;
// LIGHT_MAP
varying vec2 v_lightMapUV;

void main() {
    v_texCoord = a_texCoord;
    v_colorMul = vec4(a_colorMul.bgr * a_colorMul.a, (1.0 - a_colorAdd.a) * a_colorMul.a);
    v_colorAdd = a_colorAdd.bgr;

    // LIGHT_MAP
    v_lightMapUV = a_position.xy / 1024.0;
    
    gl_Position = u_mvp * vec4(a_position, 1.0);
}
`,wr=`
precision mediump float;

uniform sampler2D u_tex0;

varying vec2 v_texCoord;
varying vec4 v_colorMul;
varying vec3 v_colorAdd;

// LIGHT_MAP
uniform sampler2D u_tex1;
varying vec2 v_lightMapUV;
uniform vec4 u_ambientColor;

void main() {
    vec4 color = v_colorMul * texture2D(u_tex0, v_texCoord);
    // LIGHT_MAP
    float light = texture2D(u_tex1, v_lightMapUV).x;
    color = mix(mix(color, u_ambientColor, u_ambientColor.w), color, light);

    gl_FragColor = color + vec4(v_colorAdd * color.a, 0.0);
}
`,Pr="a_position",vr="a_texCoord",Cr="a_colorMul",Mr="a_colorAdd",Br="u_tex0",Or="u_tex1",Nr="u_mvp",Ir="u_ambientColor";var In=0,Ur=0,re={drawCalls:0,vertices:0,triangles:0,frameDrawCalls:0,frameVertices:0,frameTriangles:0,fps:0},kr=e=>{re.drawCalls=re.frameDrawCalls,re.frameDrawCalls=0,re.vertices=re.frameVertices,re.frameVertices=0,re.triangles=re.frameTriangles,re.frameTriangles=0,++In;let t=1;e-Ur>=t&&(re.fps=In/t,In=0,Ur+=t)};var po=[null,null,null,null,null,null,null,null,null,null,null,"\u{1F52A}","\u{1FA93}","\u{1F52B}","\u{1F58A}\uFE0F","\u270F\uFE0F\uFE0F","\u{1FAA5}","\u26CF","\u{1F50C}","\u{1F9F5}","\u{1F480}","\u{1F479}","\u{1F921}","\u{1F916}","\u{1F383}","\u{1F99D}","\u{1F419}","\u{1F430}","\u{1F98C}","\u{1F43A}","\u{1F435}","\u{1F98A}","\u{1F42D}","\u{1F98D}","\u{1F345}","\u{1F610}","\u{1F437}","\u{1F9D1}\u200D\u{1F384}","\u{1F385}\u{1F3FB}","\u{1F385}\u{1F3FC}","\u{1F385}\u{1F3FE}","\u{1F385}","\u{1F6E2}","\u{1F4E6}","\u{1FAA6}","\u2764\uFE0F","\u{1F48A}","\u{1FA99}","\u{1F48E}","\u{1F6E1}","\u{1F9F1}","\u{1F333}","\u{1F332}","\u{1F335}","\u{1F334}","\u{1F384}","\u26C4","\u{1F953}","\u{1F9B4}"],W=[],Tt,$i=e=>fetch(e).then(t=>t.arrayBuffer()),Lr=e=>new Promise((t,o)=>{let n=new Image;n.onerror=r=>o(r),n.onload=()=>t(n),n.src=e}),Wo=(e,t)=>(t=document.createElement("canvas"),t.width=t.height=e,t=t.getContext("2d"),t.fillStyle=t.strokeStyle="#fff",t.textAlign="center",t.textBaseline="alphabetic",t);async function Hr(){let[e,t]=await Promise.all([Lr("main.png"),$i("main.dat")]),o=Ve(e.width,e.height);Xe(o,e);let n=new Int32Array(t),r=new Float32Array(t),s=0,a=n[s++]|0,l=n[s++]|0,i=n[s++]|0,f=new Float32Array(t,(s+a*10)*4,l),m=new Uint16Array(t,(s+a*10+l)*4,i);for(let u=0;u<a;++u){let x=ye(o,r[s++]|0,r[s++]|0,r[s++]|0,r[s++]|0,r[s++],r[s++]);x.index0=r[s++]|0,x.triangles=r[s++]|0,x.vertex0=r[s++]|0,x.vertexCount=r[s++]|0,x.vertices=f,x.indices=m,W[u]=x}}async function Wr(){let e=await Lr("spot.png");Tt=Ve(e.width,e.height),Tt.e=.5,Tt.t=.5,Xe(Tt,e,9729)}var d=c.getContext("webgl",{antialias:!1});d.pixelStorei(37441,1);var qt=()=>g.highDPI?devicePixelRatio:1,kn=()=>{let e=qt(),t=document.body.clientWidth,o=document.body.clientHeight,n=t*e|0,r=o*e|0;(c.width!==n||c.height!==r)&&(c.width=n,c.height=r,c.style.width=t+"px",c.style.height=o+"px")};onresize=kn;setInterval(kn,1e3);kn();var mt=3+2+2,bo=(1<<18)/mt|0,yo=mt*4,E=new Float32Array(1<<18),ie=new Uint32Array(E.buffer),k=new Uint16Array(1<<18),yr=(e,t)=>(t=d.createShader(t),d.shaderSource(t,e),d.compileShader(t),t),Vr=(e,t,o)=>{let n=d.createBuffer();return d.bindBuffer(e,n),d.bufferData(e,t,o),n},Vo=(e,t,o,n,r,s)=>{d.enableVertexAttribArray(e),d.vertexAttribPointer(e,t,r,s,o,n)},zi=(e,t)=>{let o=yr(e,35633),n=yr(t,35632),r=d.createProgram();return d.attachShader(r,o),d.attachShader(r,n),d.linkProgram(r),d.deleteShader(o),d.deleteShader(n),r},N=0,y=0,qe,Xr,ot=new Float32Array([0,0,0,0]);function Pt(e){Xr=e}var tt=zi(Tr,wr),wt={program:tt,u_mvp:d.getUniformLocation(tt,Nr),u_ambientColor:d.getUniformLocation(tt,Ir),u_tex0:d.getUniformLocation(tt,Br),u_tex1:d.getUniformLocation(tt,Or),a_position:d.getAttribLocation(tt,Pr),a_texCoord:d.getAttribLocation(tt,vr),a_colorMul:d.getAttribLocation(tt,Cr),a_colorAdd:d.getAttribLocation(tt,Mr)};function xo(e,t,o=35040){return{vb:Vr(34962,e,o),ib:Vr(34963,t,o)}}var Ji=[[xo(E,k)],[xo(E,k)],[xo(E,k)],[xo(E,k)]],Yr=0,Un=0,qr=()=>{Yr=0,Un=Un+1&3};function Qi(e,t){d.bindBuffer(34962,t.vb),d.bindBuffer(34963,t.ib),Vo(e.a_position,3,yo,0,5126,!1),Vo(e.a_texCoord,2,yo,12,5126,!1),Vo(e.a_colorMul,4,yo,20,5121,!0),Vo(e.a_colorAdd,4,yo,24,5121,!0)}var ye=(e,t,o,n,r,s=.5,a=.5)=>({P:e.P,m:n,H:r,e:s,t:a,ie:t/e.m,ce:o/e.H,Re:n/e.m,Te:r/e.H}),Ve=(e,t)=>({P:d.createTexture(),m:e,H:t??e,e:0,t:0,ie:0,ce:0,Re:1,Te:1}),Xo=e=>{e.Ye=d.createFramebuffer(),d.bindFramebuffer(36160,e.Ye),d.bindTexture(3553,e.P),d.framebufferTexture2D(36160,36064,3553,e.P,0)},Xe=(e,t,o=9728)=>{d.bindTexture(3553,e.P),d.texParameteri(3553,10240,o),d.texParameteri(3553,10241,o),t?d.texImage2D(3553,0,6408,6408,5121,t):d.texImage2D(3553,0,6408,e.m,e.H,0,6408,5121,null)},jt=Ve(4);{let e=Wo(4);e.fillStyle="#FFF",e.fillRect(0,0,4,4),Xe(jt,e.canvas)}var Yo=(e,t,o,n,r,s,a,l)=>{let i=e-a*o,f=t-l*n,m=s*X(r),u=s*P(r),x=2/a,A=-2/l,_=1e5;d.uniformMatrix4fv(wt.u_mvp,!1,[m*x,u*A,0,0,-u*x,m*A,0,0,0,0,-1/_,0,(e*(1-m)+t*u)*x-2*i/a-1,(t*(1-m)-e*u)*A+2*f/l+1,0,1]),d.uniform1i(wt.u_tex0,0),d.uniform1i(wt.u_tex1,1),d.uniform4fv(wt.u_ambientColor,ot)},qo=()=>{d.enable(3042),d.blendFunc(1,771),d.useProgram(wt.program)};var jr=(e,t)=>{qo();let o=e.m,n=e.H;Yo(0,0,0,1,0,1/t,o,-n),d.bindFramebuffer(36160,e.Ye),d.viewport(0,0,o,n),d.scissor(0,0,o,n)};function Zr(e){d.uniformMatrix4fv(wt.u_mvp,!1,e)}var vt=(e,t,o,n,r,s,a=d.drawingBufferWidth,l=d.drawingBufferHeight)=>{qo(),Yo(e,t,o,n,r,s,a,l),d.bindFramebuffer(36160,null),d.viewport(0,0,a,l),d.enable(3089),d.scissor(0,0,a,l)};function Ki(){let e=Ji[Un],t=e[Yr++];return t||(t=xo(E,k),e.push(t)),t}var ce=(e=y)=>{if(e){d.activeTexture(33984),d.bindTexture(3553,qe),d.activeTexture(33984+1),d.bindTexture(3553,Xr);let t=Ki();Qi(wt,t),d.bufferSubData(34962,0,E.subarray(0,N*mt)),d.bufferSubData(34963,0,k.subarray(0,e)),d.drawElements(4,e,5123,0),++re.frameDrawCalls,re.frameTriangles+=e/3,re.frameVertices+=N,y=0,N=0}},Ye=0,ae=e=>Ye=e,Y=(e,t,o,n=0,r=1,s=1,a=1,l=16777215,i=0,f=0)=>{(qe!=e.P||N+4>=bo)&&(ce(),qe=e.P);let m=N*mt,u=(a*255<<24|l)>>>0,x=(i*255<<24|f)>>>0,A=e.e,_=e.t,D=e.m*r,S=e.H*s,F=X(n),C=P(n),B=-A*D,T=B+D,w=-_*S,v=w+S,te=e.ie,H=e.ce,oe=te+e.Re,Be=H+e.Te;E[m++]=B*F-w*C+t,E[m++]=B*C+w*F+o,E[m++]=Ye,E[m++]=te,E[m++]=H,ie[m++]=u,ie[m++]=x,E[m++]=T*F-w*C+t,E[m++]=T*C+w*F+o,E[m++]=Ye,E[m++]=oe,E[m++]=H,ie[m++]=u,ie[m++]=x,E[m++]=T*F-v*C+t,E[m++]=T*C+v*F+o,E[m++]=Ye,E[m++]=oe,E[m++]=Be,ie[m++]=u,ie[m++]=x,E[m++]=B*F-v*C+t,E[m++]=B*C+v*F+o,E[m++]=Ye,E[m++]=te,E[m++]=Be,ie[m++]=u,ie[m++]=x,k[y++]=N,k[y++]=N+1,k[y++]=N+2,k[y++]=N+2,k[y++]=N+3,k[y++]=N,N+=4};function Fe(e,t,o,n,r=0,s=1,a=1,l=1,i=16777215,f=0,m=0){(qe!=e.P||N+e.vertexCount>=bo)&&(ce(),qe=e.P);let u=(l*255<<24|i)>>>0,x=(f*255<<24|m)>>>0,A=X(r),_=P(r),D=e.ie,S=e.ce,F=e.Re,C=e.Te,B=-e.e*e.m,T=-e.t*e.H,w=e.vertex0*2,v=N*mt;for(let H=0;H<e.vertexCount;++H){let oe=e.vertices[w++],Be=e.vertices[w++],$=B+oe,ke=T+Be;E[v++]=t+(s*$*A-a*ke*_),E[v++]=o,E[v++]=n-(s*$*_+a*ke*A),E[v++]=D+F*oe/e.m,E[v++]=S+C*Be/e.H,ie[v++]=u,ie[v++]=x}let te=e.index0;for(let H=0;H<e.triangles;++H)k[y++]=N+e.indices[te++],k[y++]=N+e.indices[te++],k[y++]=N+e.indices[te++];N+=e.vertexCount}function nt(e,t,o,n=0,r=1,s=1,a=1,l=16777215,i=0,f=0){(qe!=e.P||N+e.vertexCount>=bo)&&(ce(),qe=e.P);let m=(a*255<<24|l)>>>0,u=(i*255<<24|f)>>>0,x=X(n),A=P(n),_=e.ie,D=e.ce,S=e.Re,F=e.Te,C=e.e*e.m,B=e.t*e.H,T=e.vertex0*2,w=N*mt;for(let te=0;te<e.vertexCount;++te){let H=e.vertices[T++],oe=e.vertices[T++],Be=H-C,$=oe-B;E[w++]=t+(r*Be*x-s*$*A),E[w++]=o+(r*Be*A+s*$*x),E[w++]=Ye,E[w++]=_+S*H/e.m,E[w++]=D+F*oe/e.H,ie[w++]=m,ie[w++]=u}let v=e.index0;for(let te=0;te<e.triangles;++te)k[y++]=N+e.indices[v++],k[y++]=N+e.indices[v++],k[y++]=N+e.indices[v++];N+=e.vertexCount}function Ln(e,t,o,n,r,s,a,l,i=1,f=16777215){(qe!==e.P||N+s*2>=bo)&&(ce(),qe=e.P);let m=(i*255<<24|f)>>>0,u=e.ie,x=e.ce,A=N*mt,_=0,D=z/s;for(let F=0;F<s;++F){let C=a*X(_),B=l*P(_);E[A++]=t+(n+r)*C,E[A++]=o+(n+r)*B,E[A++]=Ye,E[A++]=u,E[A++]=x,ie[A++]=m,ie[A++]=0,E[A++]=t+n*C,E[A++]=o+n*B,E[A++]=Ye,E[A++]=u,E[A++]=x,ie[A++]=m,ie[A++]=0,_+=D}let S=N;for(let F=1;F<s;++F)k[y++]=S,k[y++]=S+2,k[y++]=S+3,k[y++]=S+3,k[y++]=S+1,k[y++]=S,S+=2;k[y++]=S,k[y++]=N,k[y++]=N+1,k[y++]=N+1,k[y++]=S+1,k[y++]=S,N+=s*2}function $r(e,t,o,n,r,s,a,l=1,i=16777215){(qe!==e.P||N+r>=bo)&&(ce(),qe=e.P);let f=(l*255<<24|i)>>>0,m=e.ie,u=e.ce,x=N*mt,A=0,_=z/r;for(let S=0;S<r;++S){let F=s*X(A),C=a*P(A);E[x++]=t+n*F,E[x++]=o+n*C,E[x++]=Ye,E[x++]=m,E[x++]=u,ie[x++]=f,ie[x++]=0,A+=_}let D=N+1;for(let S=2;S<r;++S)k[y++]=N,k[y++]=D++,k[y++]=D;N+=r}var zr=new Float32Array(1),Gi=new Uint32Array(zr.buffer),Jr=e=>(Gi[0]=127<<23|e&(1<<23)-1,zr[0]-1);var ec=e=>(e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>>18,e>>>1),Ee=[,,,].fill(new Date>>>0),jo=(e=0)=>ec(Ee[e]=Sr(Ee[e],1103515245)+12345>>>0),V=e=>jo()%e,Je=(e=1,t)=>e*Jr(jo(t)),Se=(e=1)=>Je(e*2,1)-e,Zt=e=>jo(1)%e,q=e=>Je(e,1),Ct=(e=1)=>Je(e,2),Qe=e=>2*Ct(e)-e,fe=e=>jo(2)%e,Zo=e=>e[fe(e.length)];var tc=(e,t)=>{try{e.send(t)}catch{}},oc=(e,t)=>{let o=e.J;o.bufferedAmount>o.bufferedAmountLowThreshold||tc(o,t)};var Qr=(e,t)=>{oc(e,t)},Kr=e=>e.J.bufferedAmount;var Gr=[{primaryColor:"#060",splatColors:["#080","#572"],splatR:[1,16],rectW:[1,1],rectH:[4,12],treeGfx:[0,1]},{primaryColor:"#753",splatColors:["#876","#863"],splatR:[1,16],rectW:[1,4],rectH:[1,4],treeGfx:[2,3]},{primaryColor:"#acd",splatColors:["#ade","#aef"],splatR:[1,16],rectW:[1,12],rectH:[1,2],treeGfx:[4,5]}],Hn=Ve(1024),$t=Ve(1024);Xo($t);var es=(e=0,t=1024,o=Wo(t))=>{let n=V(Gr.length),r=Gr[n];o.fillStyle=r.primaryColor,o.fillRect(0,0,t,t);let s=4;for(o.scale(1,1/s);e++<t;){o.fillStyle=r.splatColors[V(r.splatColors.length)],o.beginPath();let a=r.splatR[0]+V(r.splatR[1]-r.splatR[0]);o.arc(V(t),V(t)*s,a,0,z),o.fill();let l=r.rectW[0]+V(r.rectW[1]-r.rectW[0]),i=r.rectH[0]+V(r.rectH[1]-r.rectH[0]);o.fillRect(V(t),V(t)*s,l,i)}return Xe(Hn,o.canvas),Xe($t,o.canvas),r};var _o=()=>({oe:0,s:0,Y:0,ae:0,c:[[],[],[],[]],q:new Map}),ho=(e,t)=>z*(e&t-1)/t-O,Wn=(e,t)=>t*e&t-1,Oe=(e,t,o)=>Wn((O+We(t,e))/z,o);var nc=(e,t,o)=>{e.oe=t[o++],e.s=t[o++],e.Y=t[o++]>>>0,e.ae=t[o++]>>>0;let n=t[o++];for(let s=0;s<n;++s){let a=t[o++],l=t[o++],i=t[o++],f=t[o++],m=t[o++],u={F:a&7,i:a>>3&15,B:a>>7&255,k:a>>15&255,u:a>>23&15,I:l>>16&15,ne:i>>16&31,V:f>>16&31,e:l&65535,t:i&65535,n:f&65535,f:l>>21,d:i>>21,m:f>>21,O:t[o++],l:t[o++],o:t[o++],v:m&63,p:m>>6&63,_:m>>12&15,be:m>>16&63,M:m>>22&15,C:m>>26&15};e.c[u.F].push(u)}let r=t[o++];for(let s=0;s<r;++s)e.q.set(t[o++],{_e:t[o++],he:t[o++]});return o},ts=(e,t,o=[],n,r)=>{let s=t[2],a=3;for(;s;){let l=t[a++],i=l>>21;if(o.push({s,l:e,o:l&2097151}),s+=i,!i)break}return t[1]&2&&(n=_o(),a=nc(n,t,a)),{qe:t[1]&1,s:t[0],ke:t[0]+(t[1]>>2),je:o,K:n,debug:r}};var rc=(e,t,o)=>{if(e){t[o++]=e.oe,t[o++]=e.s,t[o++]=e.Y,t[o++]=e.ae;let n=[].concat(...e.c);t[o++]=n.length;for(let r of n)t[o++]=r.F|r.i<<3|r.B<<7|r.k<<15|r.u<<23,t[o++]=r.f<<21|r.I<<16|r.e,t[o++]=r.d<<21|r.ne<<16|r.t,t[o++]=r.m<<21|r.V<<16|r.n,t[o++]=r.v|r.p<<6|r._<<12|r.be<<16|r.M<<22|r.C<<26,t[o++]=r.O,t[o++]=r.l,t[o++]=r.o;t[o++]=e.q.size;for(let[r,s]of e.q)t[o++]=r,t[o++]=s._e,t[o++]=s.he}return o},os=(e,t)=>{t[0]=e.s,t[1]=e.ke-e.s<<2|!!e.K<<1|e.qe;let o=e.je;o.sort((a,l)=>a.s-l.s);let n=o.length?o[0].s:0;t[2]=n;let r=3,s=0;for(;s<o.length;){let a=o[s++],l=o[s]?o[s].s-a.s:0;t[r++]=l<<21|a.o}return r=rc(e.K,t,r),t.buffer.slice(0,r*4)};var Ne,ut=new Map,le=[],Re=[],rs=[];{let e=i=>Ft(ut,i,o),t=()=>{_e.state[0]=="s"&&_e.resume().catch()},o=i=>({O:i,we:0,Pe:0,e:0,t:0,Le:!1,ve:!1,j:!1}),n=(i,f,m)=>{i.e=f,i.t=m,i.we=f,i.Pe=m,i.Le=!0,i.j=!0},r=(i,f,m)=>{i.e=f,i.t=m},s=i=>{i.ve=i.j,i.j=!1},a=(i,f,m=c.getBoundingClientRect())=>{f(Ne,(i.clientX-m.x)*qt()|0,(i.clientY-m.y)*qt()|0)},l=(i,f,m=c.getBoundingClientRect(),u)=>{i.preventDefault();for(u of i.changedTouches)f(e(u.identifier),(u.clientX-m.x)*qt()|0,(u.clientY-m.y)*qt()|0)};Ne=o(0),oncontextmenu=i=>i.preventDefault(),onkeydown=(i,f=i.which)=>{t(),!le[f]&&!i.repeat&&(Re[f]=le[f]=1)},onkeyup=(i,f=i.which)=>{i.preventDefault(),rs[f]=le[f],le[f]=0},c.onmousedown=i=>{a(i,n)},c.onmouseup=i=>{t(),s(Ne)},c.onmouseleave=i=>{s(Ne)},c.onmouseenter=i=>{i.buttons&&a(i,n)},c.onmousemove=i=>{a(i,r)},c.ontouchstart=i=>{l(i,n)},c.ontouchmove=i=>{l(i,r)},c.ontouchend=(i,f)=>{t(),i.preventDefault();for(f of i.changedTouches)s(e(f.identifier))}}var ns=e=>e.Le=e.ve=!1,ss=()=>{Re.length=0,rs.length=0,ns(Ne),ut.forEach(ns)},$o=()=>Re.length||Ne.ve||[...ut.values()].some(e=>e.ve);var J=0,is=()=>{J=0},zo=e=>{e>J&&(J=e)},je=()=>se(d.drawingBufferWidth,d.drawingBufferHeight)/M.camera.size,Jo=e=>e===L?Te:de.get(e)?.U;var Ao=[{length:.2,lightLength:.1,size:6,pulse:0,color:[16777215],images:[7,8,0]},{length:2,lightLength:2,size:3/2,pulse:0,color:[16777028],images:[7,8,0]},{length:1,lightLength:2,size:2,pulse:1,color:[4521983],images:[7,8,0]},{length:8,lightLength:2,size:4,pulse:0,color:[3355443],images:[5,5,5]},{length:512,lightLength:512,size:12,pulse:0,color:[16711680,65280,65535,16776960,16711935],images:[4,4,4]}];var cs=()=>({U:"",G:60,Ae:0,ot:2,nt:1,rt:0,le:0,Ce:0,He:0,ee:0,st:0,it:0,Z:1,$:0,re:0,Ze:1,$e:0,dt:1,Me:0,ue:0,z:1,ze:0,We:1,T:0,p:0,ct:0,Je:4294967295,moveWeightK:1}),yn=()=>{let e=cs();return e.le=.5,e.Ae=30,e.Ce=10,e.He=6,e.ee=300,e.Z=16,e.$=.02/5,e.re=.1,e.Me=12,e.z=2,e.ze=3,e.Je=32*60,e},Bt=()=>{let e=cs();return e.Ce=32,e.He=16,e.ee=600,e.Z=16,e.$=.02/5,e.re=.2,e.ue=1,e.Be=16768290,e.T=30,e.p=60,e.ct=24*60,e.Je=256*60,e.moveWeightK=.8,e},p=[yn(),yn(),yn(),Bt(),Bt(),Bt(),Bt(),Bt(),Bt(),Bt()],b=1;p[b].U="Knife";p[b].G=10;p[b].Ae=5;p[b].z=2;p[b].$e=-45;++b;p[b].U="Axe";p[b].G=30;p[b].Ae=15;p[b].z=8;p[b].$e=-45;p[b].moveWeightK=.9;++b;p[b].U="Pistol";p[b].z=3;p[b].le=.1;p[b].ee/=2;p[b].ot=16;p[b].Z=16;p[b].$=.02;p[b].T=9*3;p[b].moveWeightK=1;++b;p[b].U="Automatic Gun";p[b].G=5;p[b].le=.25;p[b].Ce=20;p[b].He=20;p[b].Z=16;p[b].$=.02;++b;p[b].U="Machine Gun";p[b].G=8;p[b].le=.25;p[b].Ce=20;p[b].ee/=2;p[b].Z=16;p[b].$=.05;p[b].re=.3;p[b].z=2;++b;p[b].U="Shotgun";p[b].nt=5;p[b].le=.5;p[b].Z=32;p[b].$=.1;p[b].ee=300;p[b].st=200;p[b].Me=1;p[b].rt=.5;p[b].We=2;p[b].z=2;p[b].Be=11141120;p[b].T=7;p[b].moveWeightK=.9;++b;p[b].U="Crossbow";p[b].Z=1;p[b].$=.2;p[b].re=.4;p[b].Ze=1.5;p[b].ee=960;p[b].Me=1;p[b].z=5;p[b].ue=3;p[b].Be=65280;p[b].T=7;p[b].moveWeightK=.9;++b;p[b].U="Plasma Gun";p[b].le=.5;p[b].Z=10;p[b].G=10;p[b].re=.3;p[b].$=.05;p[b].ee=420;p[b].z=1;p[b].We=2;p[b].ue=2;p[b].Be=65535;p[b].T=35;++b;p[b].U="Railgun";p[b].G=120;p[b].it=25;p[b].ee=1e3;p[b].$=.1;p[b].re=.4;p[b].Ze=1.4;p[b].z=5;p[b].We=15;p[b].ue=4;p[b].ze=10;p[b].Be=10027161;p[b].T=5;var ic=/\s/gm,cc=" ".codePointAt(0),ac="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890.,'-/",lc={supported:0,left:0,right:0,ascent:0,descent:0},mc=(e,t,o,n)=>{let r=document.createElement("canvas"),s=128;r.width=r.height=s;let a=r.getContext("2d",{willReadFrequently:!0}),l='-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif',i=Ve(s),f={fallback:l,style:n,size:t,scale:o,family:e,ctx:a,texture:i,textureBoxLT:ye(i,1,1,1,1,0,0),textureBox:ye(i,1,1,1,1,.5,.5),textureBoxT1:ye(i,1,1,1,1,.5,-1),nextSheetX:0,nextSheetY:0,sheetLineHeight:0,characters:"",border:Math.ceil(o),characterMap:new Map,lineSize:1.3,dirty:!0,strokeWidth:n.strokeWidth??0,strokeColor:n.strokeColor?`rgba(${n.strokeColor.r},${n.strokeColor.g},${n.strokeColor.b},${n.strokeColor.a})`:"rgba(0,0,0,0.5)"};return as(f),f},uc=e=>{let t=e.ctx.canvas,o=t.width<<1;e.texture.m=e.texture.H=t.width=t.height=o,e.textureBoxLT=ye(e.texture,1,1,1,1,0,0),e.textureBox=ye(e.texture,1,1,1,1,.5,.5),e.textureBoxT1=ye(e.texture,1,1,1,1,.5,-1),as(e,e.characters)},fc=e=>{let t=Math.ceil(e.size*e.scale);e.ctx.font=`${t}px ${e.family},${e.fallback}`,e.ctx.fillStyle="rgb(255,255,255)",e.ctx.textBaseline="alphabetic",e.ctx.textAlign="left"},as=(e,t=ac)=>{e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),e.ctx.fillStyle="#FFF",e.ctx.fillRect(0,0,3,3),fc(e),e.nextSheetX=4,e.nextSheetY=0,e.characterMap.clear(),dc(e),e.characters="",pc(e,t),ls(e)},dc=e=>{let t=e.ctx.measureText(" ").width/e.scale;e.characterMap.set(cc,{a:t,x:0,y:0,w:t,h:e.size*e.lineSize,tex:ye(e.texture,0,0,0,0,0,0)})},pc=(e,t)=>{let o=t.replace(ic,"");for(let n=0;n<o.length;n++)Qo(e,o.codePointAt(n))},xc=(e,t)=>{let o=lc;if(o.supported===0&&(o.supported="actualBoundingBoxLeft"in t&&"actualBoundingBoxRight"in t&&"actualBoundingBoxAscent"in t&&"actualBoundingBoxDescent"in t?2:1),o.supported===2)o.left=t.actualBoundingBoxLeft,o.right=t.actualBoundingBoxRight,o.ascent=t.actualBoundingBoxAscent,o.descent=t.actualBoundingBoxDescent;else{let n=e.size*e.scale;o.left=0,o.right=t.width,o.ascent=Math.ceil(.7*n),o.descent=Math.ceil(.3*n)}return o},Qo=(e,t)=>{if(e.characterMap.has(t))return e.characterMap.get(t);let o=String.fromCodePoint(t),n=e.ctx,r=n.canvas,s=1/e.scale,a=n.measureText(o),l=xc(e,a),i=e.border+e.strokeWidth*e.scale,f=l.right+l.left+2*i,m=l.descent+l.ascent+2*i,u=e.nextSheetX,x=e.nextSheetY;if(u+f>r.width&&(u=0,x+=e.sheetLineHeight,e.sheetLineHeight=0,x+m>r.height))return uc(e),Qo(e,t);m>e.sheetLineHeight&&(e.sheetLineHeight=m);let A={a:a.width*s,x:-(l.left+i)*s,y:-(l.ascent+i)*s,w:f*s,h:m*s,tex:ye(e.texture,u,x,f,m,0,0)};e.characterMap.set(t,A),e.characters+=o;let _=u+l.left+i,D=x+l.ascent+i;e.strokeWidth>0&&(n.strokeStyle="rgba(0,0,0,0.5)",n.lineWidth=2*e.strokeWidth*e.scale,n.lineJoin="round",n.strokeText(o,_,D),n.strokeText(o,_,D+1)),n.fillStyle="#fff",n.fillText(o,_,D);{let S=n.getImageData(u,x,f,m),F=S.data;for(let C=3;C<F.length;C+=4)F[C]=F[C]<128?0:255;n.putImageData(S,u,x)}return u+=f,e.nextSheetX=u,e.nextSheetY=x,e.dirty=!0,A},ls=e=>{e.dirty&&(Xe(e.texture,e.ctx.canvas),e.dirty=!1)},j=[],ms=()=>{j[0]=mc("m,e",24,1,{strokeWidth:3})},us=()=>j.forEach(ls);var fs=`
`.codePointAt(0),go=(e,t,o,n,r,s,a,l=16777215)=>{let i=o/e.size,f=n,m=n,u=r;for(let x of t){let A=x.codePointAt(0);if(A===fs){m=f,u+=s+a;continue}let _=Qo(e,A);_.tex&&Y(_.tex,m+i*_.x,u+i*_.y,0,i,i,1,l),m+=i*_.a}},bc=(e,t,o)=>{let n=o/e.size,r=0,s=0;for(let a of t){let l=a.codePointAt(0);if(l===fs){r=0;continue}let i=Qo(e,l);r+=n*i.a,r>s&&(s=r)}return s},_c=(e,t,o,n,r,s=16777215)=>{go(e,t,o,n,r,0,0,s)},be=(e,t,o,n,r,s=16777215)=>{n-=bc(e,t,o)/2,_c(e,t,o,n,r,s)};var I=[0,0,1],Ot=0,Nt=0,we=0,Pe=0,Go=!1,en=!1,Jt=0,Qt=0,tn=!1,on=!1,nn=!1,rn=!1,Vn=e=>{let t=p[e.i];return t&&!e.p&&t.T&&e.v<t.T},Dc=e=>!!e.M,xs=e=>{let t=d.drawingBufferWidth,o=d.drawingBufferHeight,n=Ne,r=e.e/60,s=(e.t-e.n)/60-10;if(n.e>=0&&n.e<t&&n.t>=0&&n.t<o?(Ot=(n.e-t/2)*I[2]+I[0],Nt=(n.t-o/2)*I[2]+I[1],we=Ot-r,Pe=Nt-s):(we=0,Pe=0),Go=(we||Pe)&&n.j,Jt=(le[68]|le[39])-(le[65]|le[37]),Qt=(le[83]|le[40])-(le[87]|le[38]),tn=!le[16],en=!!le[32],on=!!le[69],nn=!!le[82],rn=!!le[81],Ke[3].at=!Vn(e),Ke[4].at=!Dc(e),Ec()){let a=I[2],l=Ke[0],i=l.X;Jt=i?(i.e-i.we)*a:0,Qt=i?(i.t-i.Pe)*a:0;let f=he(Jt,Qt);tn=f>l.se,en=f>l.ge,l=Ke[1],i=l.X,we=i?(i.e-i.we)*a:0,Pe=i?(i.t-i.Pe)*a:0,f=he(we,Pe),Ot=r+we*2,Nt=s+Pe*2,Go=f>l.ge,on=!!Ke[2].X,nn=!!Ke[3].X,rn=!!Ke[4].X}},Ke=[{fe:0,de:.5,L:.5,Se:1,se:16,ge:48,text1:"RUN",text2:"JUMP"},{fe:.5,de:.5,L:1,Se:1,se:16,ge:40,text1:"AIM",text2:"FIRE"},{fe:.5,de:.25,L:.66,Se:.5,ye:1,se:16,text1:"DROP"},{fe:.66,de:.25,L:.82,Se:.5,ye:1,se:16,text1:"RELOAD"},{fe:.82,de:.25,L:1,Se:.5,ye:1,se:16,text1:"SWAP"}],Ko=!1,Fc=e=>!Ke.some(t=>t.X==e),ds=(e,t,o)=>t>e.fe&&t<e.L&&o>e.de&&o<e.Se,Ec=()=>{let e=d.drawingBufferWidth,t=d.drawingBufferHeight;for(let o of Ke){if(!o.X)for(let[,n]of ut)n.Le&&ds(o,n.we/e,n.Pe/t)&&Fc(n)&&(o.X=n);if(o.X){let n=o.X,r=!n.j;o.ye&&(r||(r=!ds(o,n.e/e,n.t/t))),r?o.X=void 0:Ko=!0}}return Ne.Le&&(Ko=[...ut.values()].some(o=>o.j)),Ko},bs=()=>{if(!Ko)return;let e=j[0].textureBox,t=d.drawingBufferWidth,o=d.drawingBufferHeight,n=1/je(),r=16;for(let s of Ke)if(!s.at){let a=t*(s.L-s.fe),l=o*(s.Se-s.de),i=n*(t*s.fe+a/2),f=n*(o*s.de+l/2),m=s.X;!s.ye&&m&&(i=m.we*n,f=m.Pe*n,$r(e,m.e*n,m.t*n,16,r,1,1,.5)),s.se!==void 0&&(be(j[0],s.text1,8,i,f-s.se-4,m?16777215:7829367),Ln(e,i,f,s.se-2,4,r,1,1,.5,m?16777215:0)),s.ge!==void 0&&(be(j[0],s.text2,8,i,f-s.ge-4,m?16777215:7829367),Ln(e,i,f,s.ge-2,4,r,1,1,.5,m?16777215:0))}};var ve=e=>Rc(...e),Rc=(e=1,t=.05,o=220,n=0,r=0,s=.1,a=0,l=1,i=0,f=0,m=0,u=0,x=0,A=0,_=0,D=0,S=0,F=1,C=0,B=0,T=44100,w=.3)=>{let v=i*=500*z/T/T,te=o*=(1+t*2*Ct()-t)*z/T,H=[],oe=0,Be=0,$=0,ke=1,ao=0,Vt=0,Le=0,Xt,He;for(n=n*T+9,C*=T,r*=T,s*=T,S*=T,f*=500*z/T**3,_*=z/T,m*=z/T,u*=T,x=x*T|0,He=n+C+r+s+S|0;$<He;H[$++]=Le)++Vt%(D*100|0)||(Le=a?a>1?a>2?a>3?P((oe%z)**3):ge(gr(oe),-1,1):1-(2*oe/z%2+2)%2:1-4*fo(Dr(oe/z)-oe/z):P(oe),Le=(x?1-B+B*P(z*$/x):1)*Rr(Le)*fo(Le)**l*e*w*($<n?$/n:$<n+C?1-($-n)/C*(1-F):$<n+C+r?F:$<He-S?(He-$-S)/s*F:0),Le=S?Le/2+(S>$?0:($<He-S?1:(He-$)/S)*H[$-S|0]/2):Le),Xt=(o+=i+=f)*X(_*Be++),oe+=Xt-Xt*A*(1-(P($)+1)*1e9%2),ke&&++ke>u&&(o+=m,te+=m,ke=0),x&&!(++ao%x)&&(o=te,i=v,ke=ke||1);let gt=_e.createBuffer(1,H.length,T);return gt.getChannelData(0).set(H),gt};var sn=[ve([,,103,,.02,.06,,1.24,-18,4.4,,,,.7,,.1,,.95,.03]),ve([1.27,,390,.01,.04,.02,4,.71,4.8,,,,,,,,.01,.6,.06]),ve([1.12,,73,,.02,.11,2,1.18,,-.1,,,,,,.3,,.55,.05,.23]),ve([1.99,,770,.03,.19,.35,,.26,,,,,,2,-50,.1,.27,.48,.06]),ve([.5,0,1500,.02,,.02,4,.68,5,,,,.01,.7,136,,,,,.11]),ve([,0,288,.05,.01,,,2,-10,,,,,,,,,.5,.1]),ve([,0,700,.01,,0,,,,,,,,,,,,.1,.01]),ve([2.21,,107,.02,.04,.07,,2.22,2,.9,,,,.4,,.5,.15,.42,.04]),ve([.5,0,43,.01,,1,2,,,,,,,,,.02,.01]),ve([.5,0,86,,,,,.7,,,,.5,,6.7,1,.05]),ve([.5*.4,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02]),ve([.3*.8,0,2200,,,.04,3,2,,,800,.02,,4.8,,.01,.1])];var pe=10*60,Kt=6*60,cn=10,Xn=cn*60,_s=31,So=15,Z=[{radius:pe,height:pe+4*60,groundLoss:512,boundsLoss:2,groundFriction:0,imass:1,shadowScale:1,shadowAdd:0,shadowColor:0,lightRadiusK:4,light:1},{radius:pe,height:pe,groundLoss:2,boundsLoss:2,groundFriction:8,imass:1,shadowScale:1,shadowAdd:0,shadowColor:0,lightRadiusK:0,light:0},{radius:Kt,height:0,groundLoss:512,boundsLoss:1,groundFriction:0,imass:1,shadowScale:2,shadowAdd:1,shadowColor:3355443,lightRadiusK:1,light:1},{radius:pe+4*60,height:Kt,groundLoss:2,boundsLoss:2,groundFriction:8,imass:1,shadowScale:1,shadowAdd:0,shadowColor:0,lightRadiusK:1,light:.5},{radius:pe+4*60,height:pe+4*60,groundLoss:512,boundsLoss:0,groundFriction:8,imass:0,shadowScale:1,shadowAdd:0,shadowColor:0,lightRadiusK:0,light:0}];var Do=e=>{e.e=pe+V(61440-pe*2),e.t=pe+V(61440-pe*2)},rt=(e,t)=>{e.e=t.e,e.t=t.t,e.n=t.n+Z[t.F].height},Fo=(e,t,o)=>{if(eo(e,e.f,e.d,e.m),e.n>0)e.m-=t;else if(e.n=0,e.m<0)return e.m=-e.m/o,!0;return!1},Yn=e=>{e.V=lt(e.V,0,2)},an=e=>{let t=Z[e.F],o=M.world,n=e.F?0:e.o&4;Fo(e,n?o.gravityWeak:o.gravity,t.groundLoss),qn(e),e.n<=0&&Zn(e,t.groundFriction),Yn(e)},qn=e=>{let t=Z[e.F];return jn(e,t.radius,t.boundsLoss)},jn=(e,t,o)=>{let n=0;return e.t>61440-t?(e.t=61440-t,n|=2,Gt(e,0,1,o)):e.t<t&&(e.t=t,n|=2,Gt(e,0,1,o)),e.e>61440-t?(e.e=61440-t,n|=4,Gt(e,1,0,o)):e.e<t&&(e.e=t,n|=4,Gt(e,1,0,o)),n},ft=(e,t,o,n)=>{to(e,o*X(t),o*P(t)/2,n)},Gt=(e,t,o,n)=>{let r=2*(e.f*t+e.d*o);e.f=(e.f-r*t)/n,e.d=(e.d-r*o)/n},As=(e,t)=>{let o=e.f*e.f+e.d*e.d;o>t*t&&(o=t/Ae(o),e.f*=o,e.d*=o)},Zn=(e,t)=>{let o=e.f*e.f+e.d*e.d;o>0&&(o=Ae(o),o=lt(o,0,t)/o,e.f*=o,e.d*=o)},st=(e,t,o=1)=>to(e,t.f,t.d,t.m,o),to=(e,t,o,n,r=1)=>{e.f+=r*t,e.d+=r*o,e.m+=r*n},eo=(e,t,o,n,r=1)=>{e.e+=r*t,e.t+=r*o,e.n+=r*n},$n=(e,t,o)=>e*e+t*t+o*o,gs=(e,t)=>{let o=e.e-t.e,n=e.t-t.t;return o*o+n*n},zn=(e,t)=>{let o=Z[e.F],n=Z[t.F],r=o.radius+n.radius;return $n(e.e-t.e,e.t-t.t,e.n+o.height-t.n-n.height)<r*r},oo=(e,t)=>{let o=Z[e.F],n=Z[t.F],r=e.e-t.e,s=(e.t-t.t)*2,a=e.n+o.height-(t.n+n.height),l=$n(r,s,a),i=o.radius+n.radius;if(l>0&&l<i*i){let f=(i/Ae(l)-1)/2;eo(e,r,s,a,o.imass*f),eo(t,r,s,a,-n.imass*f)}},ln=(e,t,o,n)=>{let r=t.e-e.e,s=t.t-e.t,a=r*o+s*n,l=Z[t.F],i=l.radius;return a>=0&&$n(r-o*a,s-n*a,t.n+l.height-e.n)<=i*i},Jn=e=>{for(let t of e)t.e=t.e&65535,t.t=t.t&65535,t.n=ge(t.n|0,0,(1<<16)-1)&65535,t.f=ge(t.f|0,-1024,1024),t.d=ge(t.d|0,-1024,1024),t.m=ge(t.m|0,-1024,1024)};var Ss=e=>{let t=1-e;return 1-t*t*t};var Eo=()=>({e:0,t:0,n:0,f:0,d:0,m:0,De:0,L:0,lt:1,pe:16777215,te:1,Qe:0,Ve:0,Oe:600,Fe:57,Ee:0,Ke:0,Ge:1,et:1,Ne:0,mt:0,ut:0,shadowScale:5}),Tc=e=>{if(e.De+=e.L,++e.Ve,Fo(e,e.lt*M.world.gravity,2)){if(e.Ne){let t=he(e.f,e.d,e.m);if(t<4||e.mt){let o=1+e.ut*t,n=e.De;e.Ee>0&&(n+=e.Ee*We(e.d,e.f)),dt.push(e.Ne,e.e/60,e.t/60,n,e.Ge*o,e.et*Ae(o),e.pe)}if(t<4)return!0}e.f/=2,e.d/=2,e.L=-e.L/2}return jn(e,4,2),e.Ve>e.Oe},wc=(e,t=0)=>{for(;t<e.length;)Tc(e[t++])&&e.splice(--t,1)};function Fs(){wc(Ze),Nc(no)}var Es,Rs,Ze=[],no=[],Ts=[],dt=[],ws=()=>{Es=Ee[1],Rs=Ze.map(e=>({...e})),Ts=no.map(e=>({...e}))},Ps=()=>{Ze.length=0,no.length=0,dt.length=0},vs=()=>{Ee[1]=Es,Ze=Rs,no=Ts,dt.length=0},Qn=(e=dt,t=0)=>{for(ae(.1);t<e.length;)nt(W[e[t++]],e[t++],e[t++],e[t++],e[t++],e[t++],1,e[t++])},Cs=()=>{for(let e of Ze)vc(e)},Pc=e=>{let t=128*60,o=1*60;for(let n of e)if(n.n>o&&n.n<t){let r=n.shadowScale*(.5-n.n/t),s=1-n.Ve/n.Oe;nt(W[0],n.e/60,n.t/60,0,r,r/4,.4*s,0)}},Ms=()=>{Pc(Ze)},vc=e=>{let t=at(0,1-e.Ee+e.Ke*he(e.f,e.d,e.m)),o=e.Ee*We(e.d-e.m,e.f),n=e.Ve/e.Oe,r=e.te+e.Qe*(n*n*n),s=o+e.De;ae(e.n/60+.1),nt(W[e.Fe],e.e/60,e.t/60,s,r*t,r,1,e.pe)},Cc=[Q("#2fff00"),Q("#00fff7"),Q("#007eff"),Q("#8300ff"),Q("#ff00ff"),Q("#ff4b00"),Q("#fffd00")],Mc=[Q("#FF0000")],mn=(e,t,o,n)=>{if(!g.blood)return;let r=g.blood===1?Mc:Cc,s=t.O??Zt(r.length),a=r[s%r.length];for(e=e*g.particles|0;e--;){let l=Eo();rt(l,t),n&&st(l,n,q(.5));let i=o*Ae(q());ft(l,Se(O),i,i*X(q(O))),l.d/=2,l.pe=xr(a,.5+q(.2)),l.Fe=59,l.Ne=6,l.mt=1,l.Ge=.5,l.et=.5/2,l.ut=(1+Ae(q()))/100,l.te=(1+q())/2,l.Ee=1,l.Ke=.02,Ze.push(l)}},Bs=(e,t,o)=>{for(e=e*g.particles|0;e--;){let n=Eo();rt(n,t),o&&st(n,o,q(.5)),ft(n,Se(O),64-128*Ae(q()),q(128));let r=q()<.3?57:58;n.Fe=r,n.Ne=r,n.te=.5+q(.25),n.Ge=n.te,n.et=n.te,n.pe=Yt(200+q(50)),n.L=Se(.1),n.De=Se(.5),Ze.push(n)}},Os=(e,t,o)=>{let n=Eo();n.e=e.e,n.t=e.t,n.n=e.n+t,n.Fe=59,n.Ne=59,n.pe=o,n.L=Se(.25),n.De=Se(O),ft(n,Se(O),16+q(32),32),Ze.push(n)};function Ns(e,t){dt.push(0,(e.e+t)/60+Se(1),e.t/60+Se(1),0,1+q(),1,Yt(68+q(16)))}function un(e,t,o){for(;o--;){let n=Eo(),r=t*Ae(q()),s=Se(O);n.e=e.e+r*X(s),n.t=e.t+r*P(s),n.n=10,n.Fe=0,n.pe=Yt(102+q(34)),n.L=Se(.25),n.De=Se(O),n.Oe=10+Zt(40),n.lt=-q(.1),n.te=8*(.4+q(.5)),n.Qe=-n.te,ft(n,Se(O),16+q(16),8),Ze.push(n)}}var Ds=0,Is=e=>{let t=e-Ds,o=60,r=o*.1;(dt.length||t>=r)&&(d.bindFramebuffer(36160,$t.Ye),qo(),Yo(0,0,0,1,0,1,1024,-1024),d.viewport(0,0,1024,1024),d.scissor(0,0,1024,1024),d.disable(2929),d.depthMask(!1),dt.length&&(Qn(),dt.length=0),t>=r&&(Y(Hn,0,0,0,1,1,se(1,t/o)),Ds=e),ce())},fn=(e,t,o,n)=>{for(e=e*g.particles|0;e--;){let r=Eo();rt(r,t),st(r,o,-q(.2)),ft(r,Se(O),32*Ae(q()),0),r.pe=n[Zt(n.length)],r.Fe=4,r.te=1+q(1),r.Qe=-r.te,r.Ee=1,r.Ke=.02,r.Oe=16+q(16),r.shadowScale=0,Ze.push(r)}},Bc=(e,t)=>({e:e.e,t:e.t,n:e.n,pt:t,ft:3*60,tt:0}),Oc=e=>(++e.tt,e.tt/e.ft>=1),Nc=(e,t=0)=>{for(;t<e.length;)Oc(e[t++])&&e.splice(--t,1)},pt=(e,t)=>{no.push(Bc(e,t))},Us=()=>{for(let e of no){let t=e.tt/e.ft;if(t>.5&&P(t*64)>.5)continue;let o=e.e/60,n=Ss(t)*60*60|0,r=(e.t-e.n-n)/60;be(j[0],e.pt,8,o,r)}};var Kn=8,ks=()=>{Kn=8},Ge=(e,t=7)=>{go(j[0],e,t,2,Kn,t,1),Kn+=t+1},dn="",It="!",Gn=1,Ut=Ne,pn=[],xn=[],Ic=()=>{Ut=Ne;for(let[,e]of ut)if(e.j||e.ve){Ut=e;break}},Ls=e=>{Ic(),Gn=e,dn="",ae(1e3)},Hs=()=>{Ut.j?It||(It="!"):It=""},Ro=(e,t,o,n)=>{xn.push({x:o,y:n,size:t,text:e})},Uc=(e,t,o,n)=>{let r=Ut.e/Gn,s=Ut.t/Gn;return r<e||s<t||r>=e+o||s>=t+n?0:1},ee=(e,t,o,n,r)=>{let s=r?.w??64,a=r?.h??16,l=r?.visible??!0;if(Uc(o,n,s,a)&&(dn=e,!It&&Ut.j&&(It=e)),l){let i=0,f=16777215;dn===e?It===e?i=1:i=0:f=11184810,pn.push({x:o+i,y:n+i,w:s,h:a,color:f}),pn.push({x:o+2,y:n+2,w:s,h:a,color:0}),xn.push({x:o+s/2+i,y:n+a/1.5+i,size:8,text:t})}return!Ut.j&&dn===e&&It===e?1:0};function Ws(){for(let e of pn)Y(W[1],e.x,e.y,0,e.w,e.h,1,e.color)}function ys(){for(let e of xn)be(j[0],e.text,e.size,e.x,e.y)}function Vs(){pn.length=0,xn.length=0}var Xs=4,kc=1024/Xs,ro=Ve(kc);Xe(ro,void 0,9729);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);Xo(ro);var Ys=()=>{Pt(jt.P),jr(ro,Xs),d.clearColor(0,0,0,1),d.clear(16384),d.disable(2929),d.depthMask(!1),d.blendFunc(1,771)},qs=(e,t,o,n)=>{Y(Tt,e,t,0,o,o,n)},js=(...e)=>{for(let t of e)for(let o of t){let n=Z[o.F],r=n.lightRadiusK,s=n.light;r>0&&s>0&&(o.F||L&&o.l===L||(r/=4),Y(Tt,o.e/60,(o.t-o.n)/60,0,r,r,s))}};var Zs=!1,Hc=0,$s=0,Wc={disconnected:"\u2B55",closed:"\u{1F534}",failed:"\u274C",connected:"\u{1F7E2}",completed:"\u2705",new:"\u{1F195}",checking:"\u{1F7E1}"},yc={connecting:"\u{1F7E1}",open:"\u{1F7E2}",closed:"\u{1F534}",closing:"\u274C"},me=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],ue=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE],zs=(e,t,o,n,r,s,a,l)=>{let i=e>$s?"\u{1F310}":"\u{1F976}",f=(o-n)*60|0,m=se(8,f);m&&(i+="\u{1F52E}"),i+=`~ ${m} of ${f}
`,$s=e,Et&&(i+="debug-lag K: "+Et+`
`),i+="visible: "+r.length+`
`,i+="players: "+s.c[0].length+`
`,i+="barrels: "+s.c[1].length+`
`,i+="items: "+s.c[3].length+`
`,i+="bullets: "+s.c[2].length+`
`,i+="trees: "+a.length+`
`,i+=`\u250C ${Te} | tic: ${e}, net-game: ${t-e}
`;for(let[,u]of de){let x=u.N,A=u.J,_=l.get(u.O);i+="\u251C "+u.U+u.O,i+=x?Wc[x.iceConnectionState]??"\u2753":"\u{1F9FF}",i+=A?yc[A.readyState]:"\u{1F9FF}",_&&(i+=`+${_.s-(e-1)}`,i+="| x"+Kr(u).toString(16)),i+=`
`}for(let u of[].concat(...s.c))u.e<me[0]&&(me[0]=u.e),u.e>ue[0]&&(ue[0]=u.e),u.t<me[1]&&(me[1]=u.t),u.t>ue[1]&&(ue[1]=u.t),u.n<me[2]&&(me[2]=u.n),u.n>ue[2]&&(ue[2]=u.n),u.f<me[0+3]&&(me[0+3]=u.f),u.f>ue[0+3]&&(ue[0+3]=u.f),u.d<me[1+3]&&(me[1+3]=u.d),u.d>ue[1+3]&&(ue[1+3]=u.d),u.m<me[2+3]&&(me[2+3]=u.m),u.m>ue[2+3]&&(ue[2+3]=u.m);i+="x := ["+me[0]+" .. "+ue[0]+`]
`,i+="y := ["+me[1]+" .. "+ue[1]+`]
`,i+="z := ["+me[2]+" .. "+ue[2]+`]
`,i+="u := ["+me[3]+" .. "+ue[3]+`]
`,i+="v := ["+me[4]+" .. "+ue[4]+`]
`,i+="w := ["+me[5]+" .. "+ue[5]+`]
`,Ge(i,4)},Js=()=>{g.dev&&(Re[48]&&ne("dev_info",g.dev_info?0:1),Re[49]&&++Hc,Re[50]&&ne("dev_collision",g.dev_collision?0:1),Re[51]&&br((Et+1)%3),Re[52]&&(Zs=!Zs))},Vc=e=>{let t=Z[e.F],o=t.radius,n=t.height,r=e.e/60,s=(e.t-e.n-n)/60,a=o/60/16;Y(W[2],r,s,0,1,(e.n+n)/60),Y(W[9],r,s,0,a,a,.5,16711680)},Qs=e=>{ae(0);for(let t of e)Vc(t)};var tr=16*60,Xc=tr*2,Ks=61440/Xc,bn=11,Gs=5,Yc=[0,1,Ks,Ks+1],_n=(e,t)=>{var o;(e[o=(t.e>>bn)+(t.t>>bn<<Gs)]??(e[o]=[])).push(t)},et=(e,t,o,n=1)=>{let r=e.e-tr>>bn,s=e.t-tr>>bn;r<0&&(r=0),s<0&&(s=0);let a=(s<<Gs)+r;for(let l=0;l<4;++l){let i=t[a+Yc[l]];if(i)for(let f of i)(f.Ue|n)&1&&o(e,f)}};var qc=e=>{let t=M.minimap;if(e.l){if(e.l===L)return t.colors.me}else return t.colors.npc;return t.colors.player},hn=(e,t,o,n,r)=>{if(o){let s=M.minimap,a=s.markerScale*r/pe,l=s.size/61440;for(let i of o){let f=n;i.F===0&&(f=qc(i)),Y(j[0].textureBox,e+l*i.e,t+l*i.t,O/4,a,a,1,f)}}},ei=(e,t,o,n)=>{let r=M.minimap,s=r.size,a=r.colors,l=o-s-1,i=n+1;Y(W[1],l,i,0,s,s,a.backgroundAlpha,a.background),hn(l,i,t,a.tree,Z[4].radius),hn(l,i,e.c[1],a.barrel,Z[1].radius),hn(l,i,e.c[3],a.item,Z[3].radius),hn(l,i,e.c[0],a.player,Z[0].radius)};var jc=e=>e.i?!p[e.i].T||e.v||e._:!1,An=(e,t,o)=>{let n=null,r=61440*61440;for(let s of t)if(o(s)){let a=gs(e,s);a<r&&(n=s,r=a)}return n},oi=(e,t)=>{let o=!t.I&&t.u<5,n=!1;if(o){let r=e.c[3],s=An(t,r,a=>a.o===0||a.o===1||a.o===4);if(s){let a=s.e-t.e,l=s.t-t.t,i=Oe(a,l,32),f=Oe(a,l,256);t.o=f<<13|i<<8|1|2}else n=!0}else if(t.i)if(jc(t)){let r=e.c[0],s=An(t,r,a=>a!==t);if(s){let a=s.e-t.e,l=s.t-t.t,i=0,f=0,m=0,u=0,x=p[t.i],A=he(a,l);A<x.ct?(m=-a,u=-l,i=3):A>x.Je?(m=a,u=l,i=3):f=8;let _=Oe(m,u,32),D=Oe(a,l,256);t.o=D<<13|_<<8|i|f}else n=!0}else{let r=e.c[3],s=An(t,r,a=>a.o===5||a._>0);if(s){let a=s.e-t.e,l=s.t-t.t,i=Oe(a,l,32),f=Oe(a,l,256);t.o=f<<13|i<<8|1|2}else n=!0}else{let r=e.c[3],s=An(t,r,a=>!!(a.o&8));if(s){let a=s.e-t.e,l=s.t-t.t,i=he(a,l),f=Oe(a,l,32),m=Oe(a,l,256),u=0;i<Z[3].radius+Z[0].radius&&!(t.C&2)&&(u=16),t.o=m<<13|f<<8|1|2|u}else n=!0}if(n){let r=V(32);t.o=r<<8|1,t.I||(!V(30)&&t.u<7&&(t.o|=4),t.u<10&&(t.o|=2))}o&&(t.o|=18)};var kt=(e=1)=>new Float32Array([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,e]),ni=(e,t,o,n,r,s,a)=>{e.set([2/(o-t),0,0,0,0,2/(r-n),0,0,0,0,1/(a-s),0,-(o+t)/(o-t),-(r+n)/(r-n),-s/(a-s),1])},ri=(e,t)=>{let o=Math.cos(t),n=Math.sin(t);e.set([1,0,0,0,0,o,n,0,0,-n,o,0,0,0,0,1])};var si=(e,t)=>{let o=Math.cos(t),n=Math.sin(t);e.set([o,n,0,0,-n,o,0,0,0,0,1,0,0,0,0,1])};var To=(e,t,o)=>{let n=t[0],r=t[1],s=t[2],a=t[3],l=t[4],i=t[5],f=t[6],m=t[7],u=t[8],x=t[9],A=t[10],_=t[11],D=t[12],S=t[13],F=t[14],C=t[15],B=o[0],T=o[1],w=o[2],v=o[3];e[0]=B*n+T*l+w*u+v*D,e[1]=B*r+T*i+w*x+v*S,e[2]=B*s+T*f+w*A+v*F,e[3]=B*a+T*m+w*_+v*C,B=o[4],T=o[5],w=o[6],v=o[7],e[4]=B*n+T*l+w*u+v*D,e[5]=B*r+T*i+w*x+v*S,e[6]=B*s+T*f+w*A+v*F,e[7]=B*a+T*m+w*_+v*C,B=o[8],T=o[9],w=o[10],v=o[11],e[8]=B*n+T*l+w*u+v*D,e[9]=B*r+T*i+w*x+v*S,e[10]=B*s+T*f+w*A+v*F,e[11]=B*a+T*m+w*_+v*C,B=o[12],T=o[13],w=o[14],v=o[15],e[12]=B*n+T*l+w*u+v*D,e[13]=B*r+T*i+w*x+v*S,e[14]=B*s+T*f+w*A+v*F,e[15]=B*a+T*m+w*_+v*C};var li=e=>{for(let t of e){let o=Z[t.F],n=(2-t.n/(60*64))*o.shadowScale;nt(W[6],t.e/60,t.t/60,0,n,n/4,.4,o.shadowColor,o.shadowAdd)}},mi=(e,t,o)=>{if(e&&(we|0||Pe|0)){let n=j[0].textureBoxT1,r=d.drawingBufferWidth,s=d.drawingBufferHeight,a=((Ot-t[0])/t[2]+r/2)/o,l=((Nt-t[1])/t[2]+s/2)/o,i=J;if(e.i){let m=p[e.i];if(m.T){if(e.p&&e._){let u=1-e.p/m.p,x=8;for(let A=0;A<x;++A){let _=ge(u*x-A,0,1);Y(n,a,l,A/x*O*2-O,2*_,5-2*_,1,16777113)}return}if(!e.v){if(P(i*32)>=0)for(let u=0;u<4;++u)Y(n,a,l,i/10+u*O/2,2,4,1,16724787);return}}}let f=4+P(2*i)*X(4*i)/4+e.ne/8+e.B/10;for(let m=0;m<4;++m)Y(n,a,l,i/10+m*O/2,2,f)}},xt=kt(),ii=kt(),ci=kt(),ai=kt(),or=kt(),so=kt(),ui=(e,t,o,n,r)=>{let s=d.drawingBufferWidth,a=d.drawingBufferHeight,l=Math.PI/4+n;ni(ii,0,s,a,0,1e5,-1e5),or[12]=-e,or[13]=-t,so[0]=o,so[5]=o*X(l)*2,so[10]=o,so[12]=s/2,so[13]=a/2,ri(ci,l),si(ai,r),To(xt,ai,or),To(xt,ci,xt),To(xt,so,xt),To(xt,ii,xt),Zr(xt)},gn=e=>Yt(255*se(1,2*e/So)),wo=(e,t,o=0,n=1,r=0)=>Fe(W[t],e.e/60,e.t/60+r,e.n/60+o,0,n,n,1,16777215,0,gn(e.V)),fi=e=>wo(e,e.o+42),di=e=>wo(e,e.o+51),pi=e=>{if(e.p){let t=M.items.lifetime>>>1;if(e.p<t){let n=1+4*(1-e.p/t);if(P(n*J)>=.5)return}}if(e.o&8)wo(e,10+e.i,4,.8),e._&&wo(e,45+5,8,.8,-.1);else{let t=J*4+e.k/25;wo(e,45+e.o,Kt/60+X(t),.9+.1*P(4*t))}},xi=e=>{let t=e.e/60,o=e.t/60,n=e.n/60,r=We(e.d,e.f),s=e.o,a=Ao[s],l=Zo(a.color),i=a.length,f=a.lightLength,m=a.size+a.pulse*P(32*J+e.k)/2;ae(n-.1),nt(W[a.images[0]],t,o,r,m*i,m,.1,16777215,1),ae(n),nt(W[a.images[1]],t,o,r,m*i/2,m/2,1,l),ae(n+.1),nt(W[a.images[2]],t,o,r,2*f,2)},bi=e=>{if(e&&e.o&8){let t=p[e.i],o=t.U+" "+po[10+e.i];t.T&&(o+=e.v);let n=e.e/60,r=e.t/60+Ye;be(j[0],o,7,n,r-28),be(j[0],"Pick [E]",7,n,r-20)}};var ze=new Map,Lt=[],Mo=[],Ie=-1,G=0,Ue=0,bt=!1,Fn=!1,io=!1,Sn=0,rr=0,Bo=0,Ht=[],Po=[],vo=[],Co=[],En=null,R=_o(),sr,U={title:!1,runAI:!1,playersAI:!1,hasPlayer:!1,tiltCamera:0,spawnNPC:!0,bloodRain:!1},$e=0,Rn=0,it=e=>({O:R.oe++,F:e,e:0,t:0,n:0,f:0,d:0,m:0,o:0,l:0,B:0,ne:0,i:0,k:V(256),V:31,u:1,I:0,_:0,v:0,p:0,be:0,M:0,C:0,Ue:0}),$c=()=>{let e=it(3);return e.o=V(6),e.p=M.items.lifetime,_t(e),e},Di=e=>Ft(ze,e,()=>({O:e,s:0,xe:0})),zc=e=>Ft(R.q,e,()=>({_e:0,he:0})),Oo=()=>{Ps(),ze.clear(),Lt.length=0,Mo.length=0,R=_o(),Pn(),Ie=-1,G=1,bt=!1,Fn=!1,io=!1,is(),Sn=0,rr=0,Bo=0,U.title=!1,U.runAI=!0,U.playersAI=!1,U.hasPlayer=!0,U.tiltCamera=0,U.spawnNPC=!0,U.bloodRain=!1},ir=()=>{Ee[0]=R.ae;let e=es();Ht.length=0,Co.length=0;let t=R.oe;for(let o=0;o<M.trees.initCount;++o){let n=it(4);n.o=e.treeGfx[V(e.treeGfx.length)],n.u=0,Do(n),Ht.push(n),_n(Co,n)}Ee[0]=R.Y,R.oe=t},_t=e=>{R.c[e.F].push(e)};function Jc(){let e=M.barrels.initCount,t=M.barrels.hp,o=M.barrels.dropWeapon.chance,n=M.barrels.dropWeapon.min;for(let r=0;r<e;++r){let s=it(1);s.u=t[0]+V(t[1]-t[0]),s.o=V(2),V(100)<o&&(s.i=n+V(p.length-n)),Do(s),_t(s)}}var Qc=()=>{Ie=0,G=1,R.ae=R.Y=Ee[0],ir(),Jc()},cr=()=>{R.Y=R.ae=Ee[0],ir();for(let e=0;e<13;++e){let t=e/13,o=it(0);o.l=1+e,o.u=10,o._=10,o.I=10,Tn(o,1+e%(p.length-1)),o.k=e+V(10)*14,o.o=Wn(t,256)<<13;let n=80+20*Ae(Je());o.e=(1024/2+n*X(t*z))*60,o.t=(1024/2+n*P(t*z)+10)*60,_t(o)}I[0]=I[1]=1024/2,Ie=0,U.hasPlayer=!1,U.tiltCamera=.05,U.bloodRain=!0,U.title=!0},Fi=e=>{zo(e),L&&Ie<0&&!de.size&&Qc();let t=!1;if(Ie<0&&de.size){let o=lr(),n=0,r=null,s=0,a=0;for(let[l,i]of de){let f=ze.get(l);f&&(f.Ie&&++a,f.startState&&f.startState.s>o&&(++n,f.startState.s>s&&(s=f.startState.s,r=f.startState)))}r&&n>=a&&(zo(performance.now()/1e3),Ue=J,R=r,G=Ie=R.s+1,ir(),Pn())}Ie>=0&&(Pi(),Ri(J),t=xa()),document.hidden||(_a(),ha(),Is(J)),Ie>=0&&(Gc(),t&&ba(),ta(),ea(),Ti())},_i=(e,t,o=0)=>{if(e){let n=p[e],r=po[10+e];return n.T?o?r+=(100*(n.p-o)/n.p|0)+"%":r+=t:r+="\u221E",r}return""},Kc=()=>{if(L){if(bt){let o=Wt();if(o){let n="",r=o.u;for(let a=0;a<10;){let l=r>a++,i=r>a++;n+=i?"\u2764\uFE0F":l?"\u{1F494}":"\u{1F5A4}"}let s=o.I;for(let a=0;a<10;){let l=s>a++,i=s>a++;n+=i?"\u{1F6E1}":l?"\u{1FA96}\uFE0F\uFE0F":""}Ge(n);{let a=_i(o.i,o.v,o.p);o.M&&(a+=" | "+_i(o.M,o.be)),Ge(a)}Ge(`\u{1F9F1}${o._}`)}else Ge("tap to respawn")}else Ge("joining");let e=o=>{let n=ar(o);return n?po[20+n.k%14]:"\u{1F441}\uFE0F"},t=o=>{let n=R.q.get(o);return`|\u2620${n?._e??0}|\u{1FA99}${n?.he??0}`};Ge(e(L)+Te+t(L));for(let[o,n]of de)Ge((Mt(n)?e(o):"\u{1F534}")+n.U+t(o))}},Wt=()=>L?ar(L):void 0,ar=e=>R.c[0].find(t=>t.l==e),hi=(e,t)=>((t=Lt.find(o=>o.s==e))||(t={s:e,l:L},Lt.push(t)),t),Ei=e=>e+at(8,(J-Ue)*60|0),Gc=()=>{Js();let e=Wt();e&&xs(e)},ea=()=>{let e=Ei(G),t=Wt(),o=0;t&&((Jt||Qt)&&(o|=Oe(Jt,Qt,32)<<8|1,tn&&(o|=2)),(we||Pe)&&(o|=Oe(we,Pe,256)<<13,Go&&(o|=8)),en&&(o|=4),on&&(o|=16),nn&&(o|=32),rn&&(o|=64)),!U.title&&L&&!io&&!t&&bt&&($o()||Fn)&&(o|=128,io=!0,Fn=!1),rr!==o&&(e<=Sn&&(e=Sn+1),Sn=e,hi(e).o&128&&(o|=128),hi(e).o=o,rr=o)},ta=()=>{if(!bt&&Ie>=0){for(let[e,t]of de)if(Mt(t)){let o=ze.get(e);if(!o||!o.Xe)return}else return;bt=!0,io=!1,Fn=!0}},lr=(e=1<<30)=>{(!L||!bt)&&(e=G+8+((J-Ue)*60|0));let t=0;for(let[,o]of ze)o.Ie&&(++t,e>o.s&&(e=o.s));return t||(e=G+((J-Ue)*60|0)),e},oa=e=>{for(let[,t]of ze)e>t.xe&&t.Ie&&(e=t.xe);return e},na=(e,t)=>{let o=G-1;e===o&&t-Ue>8/60&&(Ue=Rt(Ue,t-8/60,.01)),o+8<e&&(Ue-=1/60)},Ri=e=>{if(Ie<0)return 0;let t=lr(),o=(e-Ue)*60|0,n=0;for(;G<=t&&o--;)Ci(),Pn(),++n,Ue+=1/60;na(t,e);let r=G-1;Mo=Mo.filter(a=>a.s>r);let s=oa(r);return Lt=Lt.filter(a=>a.s>s),n},ra=new Int32Array(1024*256),Ti=()=>{let e=G-1;for(let[t,o]of de)if(Mt(o)){let n=Di(t),r=Ei(e);if(r>n.xe){let s={qe:n.Ie,ke:n.s,s:r,je:Lt.filter(a=>a.s>n.xe&&a.s<=r)};!n.Xe&&bt&&(s.K=R,n.s=R.s,n.xe=R.s),Qr(o,os(s,ra))}}},sa=(e,t)=>{if(Ie<0&&t.K&&(!e.startState||t.K.s>e.startState.s)&&(e.startState=t.K),e.Xe=t.qe,t.s>e.s){e.Ie=!0;for(let o of t.je)o.s>e.s&&Mo.push(o);e.s=t.s}e.xe<t.ke&&(e.xe=t.ke)},wi=(e,t)=>{Me<3||(sa(Di(e),ts(e,new Int32Array(t))),document.hidden&&(zo(performance.now()/1e3),Pi(),Ri(J)&&Ti()))},Ai=0,Pi=()=>{for(let[e]of ze)de.has(e)||ze.delete(e);if(L&&Ie>=0){for(let[e,t]of de)if(ze.get(e)?.Xe&&!Mt(t)){++Ai>60*5&&(ht(),alert("connection lost"));return}}Ai=0},Tn=(e,t)=>{e.i=t;let o=p[t];o&&(e.p=0,e.v=o.T)},vi=e=>{let t=ho(e.o>>13,256),o=X(t),n=P(t),r=it(3);_t(r),rt(r,e),eo(r,o,n,0,pe),st(r,e),to(r,o,n,0,64),r.o=8,r.i=e.i,r.v=e.v,r._=0,r.p=M.items.lifetime,r.V=_s,e.i=0,e.v=0},ia=e=>{e.o&16?e.C&2||(e.C|=2,e.i&&(vi(e),e.M&&vn(e))):e.C&=-3},ca=(e,t)=>{t.o&16&&(t.C&2||(t.C|=2,t.M?vi(t):vn(t),Tn(t,e.i),t._=se(10,t._+e._),t.v=e.v,Ce(t,0),e.u=e.o=0))},wn=e=>L&&e.l===L&&e.F===0,aa=(e,t)=>{if(zn(e,t)){let o=wn(t);if(e.o&8){if(o&&!En&&(En=e),e._&&t._<10){let n=10-t._,r=ge(0,e._,n);e._-=r,t._=se(10,t._+r),Ce(t,0),o&&pt(e,`+${r} mags`)}ca(e,t)}else if(e.o===0||e.o===1){if(t.u<10){let n=e.o===1?2:1;t.u=se(10,t.u+n),e.u=e.o=0,Ce(t,0),o&&pt(e,`+${n} hp`)}}else if(e.o===2||e.o===3){if(t.l){let n=zc(t.l),r=e.o===3?5:1;n.he+=r,e.u=e.o=0,Ce(t,0),o&&pt(e,`+${r} cr`)}}else e.o===5?t._<10&&(t._=se(10,t._+1),e.u=e.o=0,Ce(t,0),o&&pt(e,`+${1} mags`)):e.o===4&&t.I<10&&(++t.I,e.u=e.o=0,Ce(t,0),o&&pt(e,`+${1} sp`))}},la=()=>{let e=()=>{let r=R.c[0].filter(s=>s.l&&ze.has(s.l));return r.length?r[(J/5|0)%r.length]:void 0},t=M.camera.baseScale,o=I[0],n=I[1];if(L&&!U.title){let r=Wt(),s=r??e();if(s?.l){let a=p[s.i],l=s.e/60,i=s.t/60;if(o=l,n=i,r){let f=100*a.$*Rn/(he(we,Pe)+.001);o+=a.re*(Ot-l)-f*we,n+=a.re*(Nt-i)-f*Pe}t*=a.Ze}}I[0]=Rt(I[0],o,.1),I[1]=Rt(I[1],n,.1),I[2]=Er(I[2],t/je(),.05)},Pn=()=>{for(let e of R.c)e.sort((t,o)=>t.O-o.O),Jn(e)},nr=(e,t)=>{e.u&&e.i&&(e.l>0?e.l-t.l:-e.l-t.O)&&zn(e,t)&&Dn(t,e)},Ci=()=>{(t=>{t=Lt.concat(Mo).filter(o=>o.s==t),t.sort((o,n)=>o.l-n.l);for(let o of t)if(o.o!==void 0){let n=ar(o.l);if(n)n.o=o.o;else if(o.o&128){let r=it(0);r.l=o.l,Do(r),L==o.l&&(I[0]=r.e/60,I[1]=r.t/60),r.u=M.player.hp,r.I=M.player.sp,r._=M.player.mags,r.o=o.o,Tn(r,1+V(3)),_t(r)}}})(G),la(),Po.length=0,vo.length=0;for(let t of R.c[0])fa(t),_n(Po,t),t.Ue=1;for(let t of R.c[1])an(t),_n(vo,t),t.Ue=1;En=null;for(let t of R.c[3])an(t),t.V||et(t,Po,aa),t.u&&t.p&&G%10===0&&(--t.p,t.p||(t.u=0));for(let t of R.c[0])ia(t);for(let t of R.c[2])t.o!=4&&(Fo(t,0,0),t.u&&qn(t)&&(--t.u,fn(8,t,t,Ao[t.o].color)),et(t,Po,nr),et(t,vo,nr),et(t,Co,nr)),t.B&&!--t.B&&(t.u=0);R.c=R.c.map(t=>t.filter(o=>o.u>0));for(let t of R.c[0])t.Ue=0,et(t,Co,oo),et(t,vo,oo),et(t,Po,oo,0);for(let t of R.c[1])t.Ue=0,et(t,Co,oo),et(t,vo,oo,0);io&&Wt()&&(io=!1);for(let t of Ht)Yn(t);if(Fs(),$e=Lo($e),Rn=Lo(Rn),U.spawnNPC){let t=(1<<M.npc.period)-1;if((G&t)===0){let o=0;for(let n of R.c[0])n.l||++o;if(o<M.npc.max){let n=it(0);Do(n),n.u=10,n._=1,Tn(n,V(M.npc.initWeaponLen)),_t(n),++o}}}U.bloodRain&&da({e:fe(61440),t:fe(61440),n:fe(128)*60,F:0},128,1),Bo<G&&(Bo=G),R.Y=Ee[0],R.s=G++},ma=(e,t,o)=>{for(let n of R.c[0])n.l-e.l&&ln(e,n,t,o)&&Dn(n,e);for(let n of R.c[1])ln(e,n,t,o)&&Dn(n,e);for(let n of Ht)ln(e,n,t,o)&&Dn(n,e)},ua=e=>{Ce(e,3);let t=1+V(3);for(let o=0;o<t;++o){let n=$c();rt(n,e),st(n,e);let r=16+48*Ae(Je());if(ft(n,Je(z),r,r),As(n,64),n.V=So,e.i){n.o=8,n.i=e.i;let s=p[e.i];n.v=s.T,n._=s.T?1:0,n.p=M.items.lifetime,e.i=0}else if(e.M){n.o=8,n.i=e.M;let s=p[e.M];n.v=s.T,n._=s.T?1:0,n.p=M.items.lifetime,e.M=0}}if(e.F==0){let o=it(1);rt(o,e),st(o,e),o.m+=32,o.u=15,o.I=4,o.o=2,_t(o),mn(256,e,128,o),Bs(32,e,o)}},Dn=(e,t)=>{let o=!1;if(st(e,t,.1),e.V=So,fn(8,t,t,Ao[t.o].color),Ce(e,7),e.u){let n=t.i;if(e.I>0){let r=ge(n,0,e.I);r>0&&(e.I-=r,n-=r,e.F===0&&(fn(16,e,t,[10066329,52428,16776960]),Ce(e,2)),o=!0)}if(n){let r=ge(n,0,e.u);r>0&&(e.u-=r,n-=r,e.F===0&&(mn(16,e,64,t),Ce(e,2)),o=!0)}if(!e.u&&(ua(e),e.F===0)){let r=R.q.get(e.l);r&&(r._e=0);let s=t.l;if(s>0&&!e.F){let a=R.q.get(s)??{he:0,_e:0};if(a.he+=e.l>0?5:1,++a._e,R.q.set(s,a),g.speech&&G>Bo){let l=Jo(s),i=Jo(e.l);if(l){let f=Zo(i?M.voice.killAB:M.voice.killNPC);f=f.replace("{0}",l),f=f.replace("{1}",i),uo(f)}}}}}if(t.u&&t.o!=4){if(o)t.u=0;else if(--t.u,t.u){let n=t.e-e.e,r=t.t-e.t,s=Ae(n*n+r*r);if(s>0){n/=s,r/=s,Gt(t,n,r,1);let a=Z[e.F].radius+Kt+1;t.e=e.e+a*n,t.t=e.t+a*r}}}},vn=e=>{let t=e.i,o=e.v;e.i=e.M,e.v=e.be,e.M=t,e.be=o},gi=e=>{if(e.i&&!e.p){let t=p[e.i];t.T&&!e.v&&(e._?e.p=t.p:(e.M&&(e.be||!p[e.M].T)&&vn(e),wn(e)&&!(e.C&1)&&pt(e,"EMPTY!"),e.B=t.G))}};function Si(e,t){let o=e.i?p[e.i].moveWeightK:1;return t*o|0}var fa=e=>{U.runAI&&(!e.l||U.playersAI)&&oi(R,e);let t=e.n==0&&e.m==0;e.o&4&&t&&(e.n=1,e.m=Si(e,M.player.jumpVel),t=!1,Ce(e,5),un(e,240,8));let o=(t?16:8)/60,n=ho(e.o>>8,32),r=ho(e.o>>13,256),s=X(n),a=P(n),l=X(r),i=P(r);if(e.o&1){let m=Si(e,e.o&2?M.player.runVel:M.player.walkVel);if(e.f=lt(e.f,m*s,m*o),e.d=lt(e.d,m*a,m*o),t){let x=256/m|0;if(!((G+e.k)%x)){Zt(4)||un(e,240,1);let _=(G+e.k)%(2*x);Ns(e,_?120:-120),(G+e.k)%(4*x)||Ce(e,4)}}}else Zn(e,32*o);if(e.o&64?e.C&8||(e.C|=8,e.M&&vn(e)):e.C&=-9,e.i){let m=p[e.i];if(e.o&32?(Vn(e)&&(e._?e.p=m.p:wn(e)&&!(e.C&4)&&pt(e,"NO MAGS!")),e.C|=4):e.C&=-5,m.T&&e.p&&e._&&(--e.p,e.p||(--e._,e.v=m.T)),e.o&8){if(e.B=Lo(e.B),!e.B){if(gi(e),!m.T||!e.p&&e.v){m.T&&(--e.v,e.v||gi(e)),wn(e)&&($e=at(m.it,$e),Rn=5),e.B=m.G,e.ne=lt(e.ne,m.Z,1),e.n<=0&&to(e,l,i,-1,-m.Ce),Ce(e,1);for(let x=0;x<m.nt;++x){let A=r+m.rt*(Je()-.5)+m.le*(e.ne/m.Z)*(Je()-.5),_=X(A),D=P(A),S=m.ee+m.st*(Je()-.5),F=it(2);F.l=e.l||-e.O,rt(F,e),eo(F,_,D,0,60*m.He),F.n+=Xn-12*60,to(F,_,D,0,S),F.i=m.z,F.o=m.ue,F.u=m.We,F.B=m.ze,_t(F),m.ue==4&&(ma(F,_,D),F.i=0)}m.ue&&Os(e,Xn,m.Be)}e.C|=1}}else e.C&=-2,e.ne=e.ne/3|0,e.B=lt(e.B,m.Ae,m.ot)}let f=e.m;if(an(e),!t&&e.n<=0&&f<=0){let x=fo(8*f/M.player.jumpVel)|0;x>0&&un(e,240,x)}},da=(e,t,o,n)=>{mn(o,e,t,n)},pa=(e=R)=>({...e,c:e.c.map(t=>t.map(o=>({...o}))),q:new Map(e.q.entries())}),xa=()=>{if(!1||!bt)return!1;let e=se(8,(J-Ue)*60|0);if(!e)return!1;for(ws(),sr=R,R=pa();e--;)Ci(),Pn();return!0},ba=()=>{R=sr,Ee[0]=R.Y,G=R.s+1,vs()},_a=()=>{Aa(Ht,...R.c),ct.sort((e,t)=>61440*(e.t-t.t)+e.e-t.e),Ys(),js(R.c[0],R.c[2],R.c[3]),U.title&&qs(I[0],I[1],3+Ct(1),1),ce(),d.clear(256),d.clearDepth(1),d.enable(2929),d.depthFunc(513),d.depthMask(!0),d.depthRange(0,1),vt(0,0,0,0,0,je()),Ws(),ce(),vt(I[0]+(Qe($e/5)|0),I[1]+(Qe($e/5)|0),.5,.5,Qe($e/(8*50)),1/I[2]);{let e=I[0]+(Qe($e/5)|0),t=I[1]+(Qe($e/5)|0),o=1/I[2],n=Qe($e/(8*50)),r=Qe($e/(8*50));n+=U.tiltCamera*Math.sin(J),r+=U.tiltCamera*Math.cos(J),ui(e,t,o,n,r)}{let e=((gn(Wt()?.V)&10027008)>>>16)/255;ot[0]=ge(64/255+32/255*P(J)+e,0,1),ot[1]=17/255,ot[2]=51/255,ot[3]=.8,Pt(ro.P)}Cs(),Ea(),Qn(),ce(),d.depthFunc(515),d.depthMask(!1),Pt(jt.P);{let e=j[0].textureBoxLT,t=Dt(ot[0]*255,ot[1]*255,ot[2]*255);Y(e,-1e3,-1e3,0,1024+2e3,1001,1,t),Y(e,-1e3,1024-1,0,1024+2e3,1001,1,t),Y(e,-1e3,0,0,1001,1024,1,t),Y(e,1024-1,0,0,1001,1024,1,t)}if(ce(),Pt(ro.P),ae(0),Y($t,0,0),Ra(),ko("dev_collision")&&Qs(ct),U.title){ae(1);for(let e=10;e>0;--e){let t=.5*P(e/4+J*16),o=Dt(32*(11-e)+32*t&255,0,0),n=1+e/100,r=t*e/100,s=e/4,a=I[1]+s;Fe(W[60],I[0]+Qe(s),a+40+Qe(s),40,r,n,n,1,o)}}ce(),Pt(jt.P),d.disable(2929),ae(0),Us(),bi(En),ce()},ha=()=>{ae(1e3);let e=je();vt(0,0,0,0,0,e),L&&ei(R,Ht,d.drawingBufferWidth/e,0),U.title||(Kc(),bs()),ko("dev_fps")&&go(j[0],`FPS: ${re.fps} | DC: ${re.drawCalls} |  \u20E4 ${re.triangles} | \u2237${re.vertices}`,4,2,5,0,0),ko("dev_info")&&zs((sr??R).s+1,lr(),J,Ue,ct,R,Ht,ze),ys(),mi(Wt(),I,e),ce()},ct=[],Aa=(...e)=>{ct.length=0;let t=2*pe/60,o=d.drawingBufferWidth,n=d.drawingBufferHeight,r=I[2]/2,s=-r*o+I[0]-t,a=-r*n+I[1]-t-128,l=r*o+I[0]+t,i=r*n+I[1]+t+128;for(let f of e)for(let m of f){let u=m.e/60,x=m.t/60;(u>s&&u<l&&x>a&&x<i||m.F==2&&m.o==4)&&ct.push(m)}};function ga(e){let t=gn(e.V),o=e.k+J,n=M.bodyColor[e.k%M.bodyColor.length],r=n,s=n,a=e.e/60,l=e.t/60,i=e.n/60,f=he(e.f,e.d,e.m),m=e.o&2?1:.8,u=se(1,f/100),x=-.5*u*.5*(1+P(40*m*o)),A=(1-u)*((1+P(10*o)**2)/4);x=x+A;let _=5-4*u*.5*(1+P(40*m*o)),D=5-4*u*.5*(1+P(40*m*o+O)),S=p[e.i],F=ho(e.o>>13,256),C=S.$e*Fr,B=S.dt,T=1,w=a,v=l,te=i+cn,H=We(l+1e3*P(F)-v+te,a+1e3*X(F)-w),oe=B,Be=T,$=0;H<-.2&&H>-O+.2&&($=1);let ke=P(H-O),ao=6+12*($?ke*ke:0),Vt=1;if((H<-O*.5||H>O*.5)&&(Vt=-1),S.Me){let St=se(1,S.Ae>0?e.B/S.Ae:at(0,(e.B/S.G-.5)*2));ao+=P(St*O)*S.Me,H-=-Vt*O*.25*P((1-(1-St)**2)*z)}w+=ao*X(H),v+=ao*P(H),Vt<0&&(oe*=Vt,H-=O+2*C),H+=C,e.i&&Fe(W[10+e.i],w,v,te,H,oe,Be),Fe(W[2],a-3,l,i+5,0,2,_,1,r,0,t),Fe(W[2],a+3,l,i+5,0,2,D,1,r,0,t),Fe(W[0],a,l,i+7-x,0,8,6,1,s,0,t);let Le=a+4,Xt=a-4,He=l-i-cn+x*2,gt=v-te,Xi=We(-He+gt,w-Le),Yi=We(-He+gt,w-Xt),qi=he(w-Xt,gt-He)-1,ji=he(w-Le,gt-He)-1;if(e.i)Fe(W[4],a+4,l+.2,i+10-x,Xi,ji,2,1,r,0,t),Fe(W[4],a-4,l+.2,i+10-x,Yi,qi,2,1,r,0,t);else{let St=u*P(20*m*o),lo=u*X(20*m*o),mo=5;!e.l&&e.u<10&&!e.I&&(St-=O/2,lo+=O/2,mo+=4),Fe(W[4],a+4,l+.2,i+10-x,St+O/4,mo,2,1,r,0,t),Fe(W[4],a-4,l+.2,i+10-x,lo+O-O/4,mo,2,1,r,0,t)}{let St=e.l?20+e.k%14:34+e.k%8,lo=e.m/500,mo=e.f/500;Fe(W[St],a,l+.1,i+16-x*2,mo,1-lo,1+lo,1,16777215,0,t)}}var Sa=e=>{let t=e.e/60,o=e.t/60;if(e.l>0&&e.l!==L){let n=Jo(e.l);n&&(ae(32+e.n/60),be(j[0],n,6,t,o+2))}},Da=[Sa,,xi,,,],Fa=[ga,fi,,pi,di];function Ea(){for(let e=ct.length-1;e>=0;--e){let t=ct[e];Fa[t.F]?.(t)}}var Ra=()=>{ae(.15),li(ct),Ms();for(let e of ct)Da[e.F]?.(e)},Ce=(e,t)=>{if(G>Bo){let o=M.camera.listenerRadius,n=(e.e/60-I[0])/o,r=(e.t/60-I[1])/o,s=1-he(n,r);s>0&&hr(sn[t],s,ge(n,-1,1))}};var Mi=(e,t)=>{wi(e,t.data)};var Bi=[{urls:"stun:openrelay.metered.ca:80"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"}];var ur=e=>e,Me=0,de=new Map,co=null,L=0,Te=g.name,yt=[],Cn=!1,Oi=1,Bn=[],Ni=()=>fetch(ur("i"),{method:"POST"}).then(e=>e.json()).then(e=>Number.parseInt(e?.on)).catch(()=>0),fr=e=>{e||(e="Guest "+(Math.random()*1e3|0)),Te=ne("name",e.trim().substring(0,32).trim())},No=(e,t,o,n=0)=>yt.push([L,e,t,n,o]),Ta=(e,t,o,n)=>{Bn[Oi]=n,No(e,t,o,Oi++)},ht=()=>{co&&(co.close(),co=null),de.forEach(Ii),L=0,Me=0},wa=(e,t)=>e.N.setRemoteDescription(t).then(()=>e.N.createAnswer()).then(o=>e.N.setLocalDescription(o)).then(()=>e.N.localDescription.toJSON()).catch(()=>{}),Pa=[,e=>wa(Mn(e[0]),e[4]),(e,t)=>{e[4].candidate&&Mn(e[0]).N.addIceCandidate(new RTCIceCandidate(e[4])).catch(o=>{})},e=>{Mn(e[0]).U=e[4]}],va=e=>Pa[e[2]](e)?.then(t=>yt.push([L,e[0],e[2],e[3],t])),dr=()=>{Me>1&&!Cn&&yt.length&&(Cn=!0,Ca(yt).then(e=>{yt=yt.slice(e),Cn=!1}).catch(ht))},Ca=e=>fetch(ur("_"),{method:"POST",body:JSON.stringify([L,e])}).then(t=>t.json()),Ma=[ht,()=>{No(0,0,0),dr()},(e,t)=>{t=e.split(",").map(Number),L=t.shift(),Me=2,Promise.all(t.map(o=>(No(o,3,Te),Oa(Mn(o))))).then(o=>Me=3).catch(ht)},(e,t,o,n)=>{t=JSON.parse(e),o=t[3],n=Bn[o],Bn[o]=0,(n||va)(t)},(e,t)=>{t=+e,t>0?No(t,3,Te):Ii(de.get(-t))}],pr=e=>{Me||(e?(Me=3,L=1):(Me=1,Cn=!1,yt=[],Bn=[],co=new EventSource(ur("_?v="+Uo)),co.onerror=t=>{ht()},co.onmessage=t=>Ma[t.data[0]]?.(t.data.substring(1))))},mr=(e,t)=>e.N.createOffer({iceRestart:t}).then(o=>e.N.setLocalDescription(o)).then(()=>Ta(e.O,1,e.N.localDescription.toJSON(),o=>e.N.setRemoteDescription(new RTCSessionDescription(o[4])))),Ba=(e,t)=>{let o={O:e,N:t=new RTCPeerConnection({iceServers:Bi})};return t.onicecandidate=n=>{n.candidate&&No(e,2,n.candidate.toJSON())},t.onnegotiationneeded=()=>{mr(o,!1)},t.ondatachannel=n=>{o.J=n.channel,Ui(o)},o},Ii=e=>{de.delete(e?.O)&&(e.J?.close(),e.N?.close())},Oa=async e=>{e.N.oniceconnectionstatechange=t=>{"fd".indexOf(e.N?.iceConnectionState[0])>=0&&mr(e,!0).catch()},await mr(e),e.J=e.N.createDataChannel(0,{ordered:!1,maxRetransmits:0}),Ui(e),await new Promise((t,o)=>{let n=50,r=setInterval(()=>{Mt(e)?(clearInterval(r),t()):--n||o()},100)})},Ui=e=>{e.J&&(e.J.binaryType="arraybuffer",e.J.onmessage=t=>Mi(e.O,t))},Mn=e=>Ft(de,e,Ba),Mt=e=>e?.J?.readyState[0]=="o"&&e?.N?.iceConnectionState[1]=="o";var At=[0,2,3,5,7,8,10,12,12+2,12+3,12+5,12+7,12+8,12+10],On=_e.createBiquadFilter();On.connect(_e.destination);var Io=(e,t,o,n=1,r=_e.destination)=>{let s=_e.createBufferSource();s.buffer=sn[e],s.detune.value=t*100,s.connect(r),s.start(o,0,n)},Li=0,ki=0;function Na(e,t,o){let n=0,r=0,s=fe(2)&&!e,a=fe(2)&&!e,l=fe(4)==0||e,i=e?0:fe(2),f=e?fe(2e3):fe(1e4);On.Q.linearRampToValueAtTime(i,t+(n+8)*o),On.frequency.linearRampToValueAtTime(f,t+(n+8)*o);for(let m=0;m<16;++m){Li%4==3&&(fe(4)==0&&!e?r=14+fe(5):r=4+fe(5));let u=At[r%At.length];n%4==2&&(u=At[(r+1)%At.length]),n%4==3&&(u=At[(r+2)%At.length]),m>12&&(u=At[(r+1+fe(5))%At.length]),(n%16<8||!l)&&Io(8,u,t+o*n,o,On),n%4==0&&(n%8==4&&s?Io(10,-4,t+n*o,o*2):Io(9,0,t+n*o,o*2)),n%16==11&&fe(2)&&s&&Io(9,0,t+n*o,o*2),(n%8>5||n%2==0)&&a&&Io(11,0,t+n*o,o),++n}}var Hi=e=>{let t=_e.currentTime;if(t>=ki){let o=60/(110+15*P(t/10))/4;ki=t+16*o,g.music&&Na(e,t,o),++Li}};function Wi(e){let t=performance.now(),o=n=>{if(requestAnimationFrame(o),g.frameRateCap>0){let r=n-t,s=.1,a=1e3/g.frameRateCap;r>=a-s&&(t=n-r%a,e(n))}else t=n,e(n)};requestAnimationFrame(o)}var De=document.createElement("div");De.style.color="white";De.style.width="100%";De.style.height="100%";De.style.position="absolute";De.style.left="0";De.style.top="0";De.style.zIndex="99999";De.style.fontFamily="monospace";De.style.background="#000";De.innerHTML=`
<div style="position: fixed;top: 50%;left: 50%;
transform: translate(-50%, -50%); text-align: center">
<h1 style="color:red">13</h1>
<h2 style="color:lightcyan">loading...</h2>
<h3 id="preloader-progress">.</h3>
</div>`;document.body.appendChild(De);function yi(e){let t=document.getElementById("preloader-progress"),o=16;if(t){let n=e*o|0,r=o-n;t.innerText=`[ ${"x".repeat(n)}${".".repeat(r)} ]`}}function Vi(){De.style.opacity="0",De.style.transition="all 0.2s 0.1s ease-out",setTimeout(()=>{De.remove()},300)}{let e=0,t=0,o=0,n=0,r=()=>{t=2,Oo(),cr(),U.title=!0,U.playersAI=!0,U.spawnNPC=!0,uo("13 the game")};Te||fr();let s=0,a=4,l=()=>{yi(s/a)},i=u=>u.then(x=>(++s,l(),x));l(),Promise.all([i(new FontFace("m","url(m.ttf)").load().then(u=>document.fonts.add(u))),i(new FontFace("e","url(e.ttf)").load().then(u=>document.fonts.add(u))),i(Hr()),i(Wr())]).then(u=>{ms(),t=1,Oo(),cr(),U.spawnNPC=!1,Vi()});let f=[,,()=>{let u=je();Ls(u);{let x=d.drawingBufferWidth/u|0,A=d.drawingBufferHeight/u|0,_=x>>1,D=A>>1;if(o===0)Ro("Welcome back,",7,_,14),ee("change_name",Te+" \u270F\uFE0F",_-64/2,20)&&fr(prompt("your name",Te)),Ro(e+" playing right now",7,_,D+45),ee("dev_mode","",_-40,D-40,{w:80,h:80,visible:!1})&&++n>3&&(ne("dev",1),o=2),ee("start","\u2694 FIGHT",_-50,D+50,{w:100,h:20})&&(t=3,Oo(),U.title=!0,U.tiltCamera=.05,U.bloodRain=!0,pr()),ee("practice","\u{1F3F9} PRACTICE",_-50,D+75,{w:100,h:20})&&(t=4,Oo(),pr(!0)),ee("settings","\u2699\uFE0F SETTINGS",_-50,D+108,{w:100,h:16})&&(o=1);else if(o===1){Ro("\u2699\uFE0F SETTINGS",20,_,30),ee("sounds","\u{1F50A} SOUNDS: "+(g.sound?"ON":"OFF"),_-50,D-70,{w:100,h:20})&&ne("sound",g.sound?0:1),ee("music","\u{1F3B5} MUSIC: "+(g.music?"ON":"OFF"),_-50,D-40,{w:100,h:20})&&ne("music",g.music?0:1),ee("speech","\u{1F4AC} SPEECH: "+(g.speech?"ON":"OFF"),_-50,D-10,{w:100,h:20})&&ne("speech",g.speech?0:1),ee("blood",["\uFE0F\u200D\u{1FA79} FX: NONE","\u{1FA78} FX: BLOOD","\u{1F3A8} FX: PAINT "][g.blood],_-65,D+20,{w:80,h:20})&&ne("blood",(g.blood+1)%3);let F=g.particles>0?"X"+g.particles:"OFF";ee("particles","\uFE0F\u2728 "+F,_+25,D+20,{w:40,h:20})&&(g.particles*=2,g.particles<=0&&(g.particles=.5),g.particles>4&&(g.particles=0),ne("particles",g.particles)),ee("highDPI","\u{1F5A5}\uFE0F HIGH-DPI: "+(g.highDPI?"ON":"OFF"),_-85,D+50,{w:80,h:20})&&ne("highDPI",g.highDPI?0:1),ee("frameRateCap","FPS LIMIT: "+(g.frameRateCap>0?g.frameRateCap+"hz":"OFF"),_+5,D+50,{w:80,h:20})&&ne("frameRateCap",g.frameRateCap>0?0:Nn),(ee("back","\u2B05 BACK",_-50,D+90,{w:100,h:20})||Re[27])&&(o=0)}else o===2&&(Ro("\u2699\uFE0F DEVELOPER",20,_,30),ee("fps","FPS: "+(g.dev_fps?"ON":"OFF"),_-50,D-70,{w:100,h:20})&&ne("dev_fps",g.dev_fps?0:1),ee("collision","COLLISION: "+(g.dev_collision?"ON":"OFF"),_-50,D-40,{w:100,h:20})&&ne("dev_collision",g.dev_collision?0:1),ee("console","LOGS: "+(g.dev_console?"ON":"OFF"),_-50,D-10,{w:100,h:20})&&ne("dev_console",g.dev_console?0:1),ee("info","INFO: "+(g.dev_info?"ON":"OFF"),_-50,D+20,{w:100,h:20})&&ne("dev_info",g.dev_info?0:1),ee("dev_disable","DISABLE",_-30,D+50,{w:60,h:10})&&(ne("dev",0),o=0),(ee("back","\u2B05 BACK",_-50,D+90,{w:100,h:20})||Re[27])&&(o=0));ee("version_tag","\u{1F3F7} v"+Uo,2,A-16,{w:48,h:14,visible:!0})&&open("https://github.com/eliasku/13","_blank")}Hs()}],m=[,u=>{let x=je(),A=d.drawingBufferWidth/x|0,_=d.drawingBufferHeight/x|0,D=A>>1,S=_>>1;vt(0,0,0,0,0,x);let F=14+.5*Math.sin(8*u);P(u*8)<=0&&be(j[0],"PRESS ANY KEY",F,D,S+50,14286694),ce(),$o()&&(t=2,U.playersAI=!0,U.spawnNPC=!0,Ni().then(C=>{e=C}))},()=>{},u=>{let x=je(),A=d.drawingBufferWidth/x|0,_=d.drawingBufferHeight/x|0,D=A>>1,S=_>>1;vt(0,0,0,0,0,je());let F=10+.5*Math.sin(4*u);be(j[0],"CONNECTING",F,D,S+40,14286694),be(j[0],".".repeat(u*7&7),F,D,S+50,14540253),ce(),Me==3?(U.title=!1,U.tiltCamera=0,U.bloodRain=!1,t=4,uo("fight")):Me||r()},()=>{Re[27]&&ht(),Me||r()}];Wi(u=>{u/=1e3,kr(u),Hi(t!==4),f[t]?.(u),t>=1&&Fi(u),m[t]?.(u),us(),ks(),ss(),dr(),Vs(),qr()})}

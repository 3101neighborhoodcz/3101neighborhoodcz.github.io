<!DOCTYPE html>
<html>
<head>
<title>Скибиди Туалеты Стрелялка - Vseigru.net</title>
<link rel="stylesheet" href="../../lib/game-loader/gameloader2020.css" />
<script src="../../lib/game-loader/gameloader2020.js"></script>
<script>
	    var onOpenTimeout = 100,
		onRewardedTimeout = 5000,
		onCloseTimeout = 5100;
</script>
<script src="../../lib/ysdk/v2.js"></script>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<script>
        YaGames.init(
            {
                adv:
                {
                    onAdvClose: wasShown => {
                        console.info('adv closed!');
                    }
                }
            })
            .then(ysdk => {
                ysdk.adv.showFullscreenAdv();
                window.ysdk = ysdk;
            });

        function initPlayer(photoSize, _scopes) {
            return ysdk.getPlayer({ scopes: _scopes }).then(_player => {

                player = _player;

                var playerName = player.getName();
                var playerPhoto = player.getPhoto(photoSize);

                if (!_scopes){
                    playerName = "anonymous";
                    playerPhoto = "null";
                }

                if (player.getMode() === 'lite') {

                    // ����� �� �����������
                    NotAuthorized();
                }
                else
                {
                    // ����� �����������
                    console.log('auth ok');
                    var authJson = { "playerAuth": "resolved", "playerName": playerName, "playerId": player.getUniqueID(), "playerPhoto": playerPhoto };
                    window.unityInstance.SendMessage('YandexGame', 'SetAuthorization', JSON.stringify(authJson));
                }
            }).catch(err =>
            {
                // ������ ��� ������������� ������� Player
                console.log('auth err');
                NotAuthorized();
            });
        }

        function NotAuthorized()
        {
            console.log('auth failed');
            var authJson = { "playerAuth": "rejected", "playerName": "unauthorized", "playerId": player.getUniqueID(), "playerPhoto": "null" };
            window.unityInstance.SendMessage('YandexGame', 'SetAuthorization', JSON.stringify(authJson));
        }

        function AuthorizationCheck(photoSize, scopes) {
            initPlayer(photoSize, scopes);
        }

        function OpenAuthDialog(photoSize, scopes) {
            ysdk.auth.openAuthDialog().then(() => {
                initPlayer(photoSize, scopes);
            }).catch(() => {
                AuthorizationCheck(photoSize, scopes);
            });
        }

        function SaveCloud(jsonData, flush){
            player.setData({
                saves: [jsonData],
            }, flush).then(() => {
                console.log('Cloud saves are installed');
            });
        }

        function LoadCloud(){
            player.getData(["saves"]).then(data => {
                if (data.saves) {
                    window.unityInstance.SendMessage('YandexGame', 'SetLoadSaves', JSON.stringify(data.saves));
                }
                else{
                    ResetProgress();
                }
            }).catch(() => {
                console.log('load err');
            });
        }

        function ResetProgress(){
            window.unityInstance.SendMessage('YandexGame', 'ResetSaveCloud');
        }

        function InitLeaderboard() {
            ysdk.getLeaderboards().then(_lb => {
                lb = _lb
                window.unityInstance.SendMessage('YandexGame', 'InitializedLB');
            });
        }

        function SetLeaderboardScores(_name, score) {
            ysdk.getLeaderboards()
                .then(lb => {
                    lb.setLeaderboardScore(_name, score);
                });
        }

        function GetLeaderboardScores(nameLB, maxPlayers, quantityTop, quantityAround, photoSize, auth)
        {
            console.log('LeaderBoard Name: ' + nameLB);

            if (auth)
            {
                ysdk.getLeaderboards()
                    .then(lb => {
                        lb.getLeaderboardEntries('' + nameLB, { quantityTop: quantityTop, includeUser: true, quantityAround: quantityAround })
                            .then(res => {
                                EntriesLB(res, nameLB, maxPlayers, photoSize);
                            });
                        });
            }
            else
            {
                ysdk.getLeaderboards()
                    .then(lb => {
                        lb.getLeaderboardEntries('' + nameLB, { quantityTop: quantityTop })
                            .then(res => {
                                EntriesLB(res, nameLB, maxPlayers, photoSize);
                            });
                        });
            }
        }

        function EntriesLB(res, nameLB, maxPlayers, photoSize)
        {
            console.log(res);
            var LeaderboardEntriesText = '';

            var playersCount;
            if (res.entries.length < maxPlayers) {
            playersCount = res.entries.length;
            }
            else {
                playersCount = maxPlayers;
            }

            let rank = [maxPlayers];
            let photo = [maxPlayers];
            let playersName = [maxPlayers];
            let scorePlayers = [maxPlayers];

            var i;
            for (i = 0; i < playersCount; i++) {
                rank[i] = res.entries[i].rank;
                scorePlayers[i] = res.entries[i].score;

                if (photoSize == 'nonePhoto' || res.entries[i].player.scopePermissions.avatar != "allow") {
                    photo[i] = 'nonePhoto';
                }
                else {
                    photo[i] = res.entries[i].player.getAvatarSrc(photoSize);
                }

                if (res.entries[i].player.scopePermissions.public_name != "allow") {
                    playersName[i] = "Anonymous";
                }
                else {
                    playersName[i] = res.entries[i].player.publicName;
                }

                LeaderboardEntriesText += rank[i] + '. ' + playersName[i] + ": " + scorePlayers[i] + '\n';
            }

            if (playersCount == 0) {
                LeaderboardEntriesText = 'No data';
            }

            var jsonLB = { "nameLB": nameLB, "entries": LeaderboardEntriesText, "rank": rank, "photo": photo, "playersName": playersName, "scorePlayers": scorePlayers };
            window.unityInstance.SendMessage('YandexGame', 'LeaderboardEntries', JSON.stringify(jsonLB));
        }

        function FullscreenShow() {
            window.ysdk.adv.showFullscreenAdv(
                {
                    callbacks: {
                        onOpen: () => {
                          window.unityInstance.SendMessage('YandexGame', 'OpenFullscreen');
                        },
                        onClose: () => {
                          window.unityInstance.SendMessage('YandexGame', 'CloseFullscreen');
                        }
                    }
                });
        }

        function RewardedShow(id) {
            window.ysdk.adv.showRewardedVideo(
                {
                    callbacks:
                    {
                        onOpen: () => {
                          window.unityInstance.SendMessage('YandexGame', 'OpenVideo', id);
                        },
                        onClose: () => {
                          window.unityInstance.SendMessage('YandexGame', 'CloseVideo', id);
                            console.log('Video ad closed. Id: ' + id);
                        }
                    }
                });
        }

        function LanguageRequest() {
            window.unityInstance.SendMessage('YandexGame', 'SetLanguage', ysdk.environment.i18n.lang);
        }

        function RequestingEnvironmentData() {
            var jsonEnvir = { "domain": ysdk.environment.i18n.tld, "deviceType": ysdk.deviceInfo.type, "isMobile": ysdk.deviceInfo.isMobile(), "isDesktop": ysdk.deviceInfo.isDesktop(), "isTablet": ysdk.deviceInfo.isTablet(), "isTV": ysdk.deviceInfo.isTV() };
            window.unityInstance.SendMessage('YandexGame', 'SetEnvironmentData', JSON.stringify(jsonEnvir));
        }

        function Review() {
            ysdk.feedback.canReview()
                .then(({ value, reason }) => {
                    if (value) {
                        ysdk.feedback.requestReview()
                            .then(({ feedbackSent }) => {
                                console.log(feedbackSent);
                            })
                    } else {
                        console.log(reason)
                    }
                })
        }
</script>
<script type="text/javascript">
	var options = {
		author: "Vseigru",
		logo: "logo.jpg",
		gameName: "Скибиди Туалеты Стрелялка",
		gameNameEu: "Skibidi Toilets Shooter",
		gameUrl: "39930",
		moreLink: ("https://vseigru.net"),
		allowFullscreen: true,
		locale: "ru_RU",
		loader: "unity2020",
		loaderOptions: {
			unityLoaderUrl: "Build/SkibidiToilets.loader.js",
			unityConfigOptions: {
				dataUrl: "Build/SkibidiToilets.data.unityweb",
				frameworkUrl: "Build/SkibidiToilets.framework.js.unityweb",
			    codeUrl: "Build/SkibidiToilets.wasm.unityweb",
				streamingAssetsUrl: "StreamingAssets"
			}
		},
    };
	GameInit.load(options);	  
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'89f413125e7fb7be',t:'MTcyMDMxNTg4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
